---
slug: server-github-workflow
title: GitHub Workflow
authors: [ lianghchao ]
tags: [ server ]
---

## æ›´æ–°åŸŸåè§£æå®šæ—¶ä»»åŠ¡ï¼Œè§£ææœåŠ¡å•†[No-IP](https://my.noip.com/)

```java
import cn.hutool.http.HttpRequest;
import cn.hutool.core.codec.Base64;
import cn.hutool.http.HttpUtil;
import jakarta.annotation.PostConstruct;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.URLEncoder;
import java.nio.charset.StandardCharsets;

@Component
public class MyScheduledTask {


    // âš™ï¸ é…ç½®ä¿¡æ¯ï¼ˆè¯·æ›¿æ¢ä¸ºä½ çš„ï¼‰
    private static final String USERNAME = "example";
    private static final String PASSWORD = "example";
    private static final String HOSTNAME = "example.ddns.net"; // è¦æ›´æ–°çš„åŸŸå

    // ğŸŒ API åœ°å€
    private static final String UPDATE_URL = "https://dynupdate.no-ip.com/nic/update";
    private static final String IP6_CHECK_URL = "https://ipv6.icanhazip.com"; // è·å–å…¬ç½‘ IPv6

    @Scheduled(cron = "0 0 * * * *")
    public void updateDNSTask() {
        updateDNSUtil();
    }
    @PostConstruct
    public void init(){
        updateDNSUtil();
    }

    public void updateDNSUtil() {
        try {
            // 1. è·å–å½“å‰å…¬ç½‘ IPv6
            Process process = Runtime.getRuntime().exec("curl -6 --max-time 10 "+IP6_CHECK_URL);
            BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
            String currentIPv6 = reader.readLine();
            System.out.println(currentIPv6);
            if (currentIPv6 == null || currentIPv6.trim().isEmpty()) {
                System.err.println("âŒ æ— æ³•è·å–å…¬ç½‘ IPv6 åœ°å€");
                return;
            }
            System.out.println("ğŸŒ å½“å‰å…¬ç½‘ IPv6: " + currentIPv6);

            // 2. æ›´æ–° No-IP AAAA è®°å½•
            String result = updateNoIpAAAA(currentIPv6);
            System.out.println("âœ… æ›´æ–°ç»“æœ: " + result);

        } catch (Exception e) {
            System.err.println("âŒ æ›´æ–°å¤±è´¥: " + e.getMessage());
        }
    }

    /**
     * æ›´æ–° No-IP çš„ AAAA è®°å½•
     */
    public static String updateNoIpAAAA(String ipv6) {
        // æ„é€ è¯·æ±‚ URL: https://dynupdate.no-ip.com/nic/update?hostname=xxx&myip=IPv6
        String urlString = UPDATE_URL +
                "?hostname=" + URLEncoder.encode(HOSTNAME, StandardCharsets.UTF_8) +
                "&myip=" + URLEncoder.encode(ipv6, StandardCharsets.UTF_8);

        // è®¾ç½®è®¤è¯å¤´ï¼šBasic Base64(username:password)
        String auth = USERNAME + ":" + PASSWORD;
        String encodedAuth = Base64.encode(auth.getBytes(StandardCharsets.UTF_8));

        // ä½¿ç”¨ Hutool HttpUtil å‘é€è¯·æ±‚
        try {
            String response = HttpRequest.get(urlString)
                    .header("Authorization", "Basic " + encodedAuth)
                    .header("User-Agent", "NoIP-Updater-Java/1.0")
                    .timeout(10000)
                    .execute()
                    .body();
            return response != null ? response.trim() : "Unknown response";
        } catch (Exception e) {
            // å¤„ç†å¼‚å¸¸æƒ…å†µ
            return "Error: " + e.getMessage();
        }
    }

}

```