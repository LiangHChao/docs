<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-javadoc docs-version-current docs-doc-page docs-doc-id-mq/2026-01-22-rocket mq" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">java rocketmq | LiangHChao的个人博客项目</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lianghchao.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lianghchao.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lianghchao.github.io/docs/javadoc/mq/java-rocketmq"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-javadoc-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-javadoc-current"><meta data-rh="true" property="og:title" content="java rocketmq | LiangHChao的个人博客项目"><meta data-rh="true" name="description" content="java rocketmq"><meta data-rh="true" property="og:description" content="java rocketmq"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lianghchao.github.io/docs/javadoc/mq/java-rocketmq"><link data-rh="true" rel="alternate" href="https://lianghchao.github.io/docs/javadoc/mq/java-rocketmq" hreflang="en"><link data-rh="true" rel="alternate" href="https://lianghchao.github.io/docs/javadoc/mq/java-rocketmq" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"消息队列相关","item":"https://lianghchao.github.io/docs/javadoc/category/消息队列相关"},{"@type":"ListItem","position":2,"name":"java rocketmq","item":"https://lianghchao.github.io/docs/javadoc/mq/java-rocketmq"}]}</script><link rel="alternate" type="application/rss+xml" href="/docs/blog/rss.xml" title="LiangHChao的个人博客项目 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/blog/atom.xml" title="LiangHChao的个人博客项目 Atom Feed"><link rel="stylesheet" href="/docs/assets/css/styles.c51ffe61.css">
<script src="/docs/assets/js/runtime~main.799875eb.js" defer="defer"></script>
<script src="/docs/assets/js/main.0faa3497.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="我的文档 Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo.svg" alt="我的文档 Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">我的文档</b></a><a class="navbar__item navbar__link" href="/docs/docs/intro">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/javadoc/intro">Java</a><a class="navbar__item navbar__link" href="/docs/sqlDoc/intro">SQL</a><a class="navbar__item navbar__link" href="/docs/blog">博客</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/LiangHChao/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/javadoc/intro"><span title="模块介绍" class="linkLabel_WmDU">模块介绍</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/maven相关"><span title="Maven相关" class="categoryLinkLabel_W154">Maven相关</span></a><button aria-label="Expand sidebar category &#x27;Maven相关&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/javadoc/category/消息队列相关"><span title="消息队列相关" class="categoryLinkLabel_W154">消息队列相关</span></a><button aria-label="Collapse sidebar category &#x27;消息队列相关&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/javadoc/mq/java-rocketmq"><span title="java rocketmq" class="linkLabel_WmDU">java rocketmq</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/mybatis-plus"><span title="Mybatis Plus" class="categoryLinkLabel_W154">Mybatis Plus</span></a><button aria-label="Expand sidebar category &#x27;Mybatis Plus&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/spring-boot"><span title="Spring Boot" class="categoryLinkLabel_W154">Spring Boot</span></a><button aria-label="Expand sidebar category &#x27;Spring Boot&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/工作流"><span title="工作流" class="categoryLinkLabel_W154">工作流</span></a><button aria-label="Expand sidebar category &#x27;工作流&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/设计模式"><span title="设计模式" class="categoryLinkLabel_W154">设计模式</span></a><button aria-label="Expand sidebar category &#x27;设计模式&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/文件服务"><span title="文件服务" class="categoryLinkLabel_W154">文件服务</span></a><button aria-label="Expand sidebar category &#x27;文件服务&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/过滤器拦截器"><span title="过滤器&amp;拦截器" class="categoryLinkLabel_W154">过滤器&amp;拦截器</span></a><button aria-label="Expand sidebar category &#x27;过滤器&amp;拦截器&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/注解"><span title="注解" class="categoryLinkLabel_W154">注解</span></a><button aria-label="Expand sidebar category &#x27;注解&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/spring-集成测试"><span title="spring 集成测试" class="categoryLinkLabel_W154">spring 集成测试</span></a><button aria-label="Expand sidebar category &#x27;spring 集成测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/腾讯相关接口"><span title="腾讯相关接口" class="categoryLinkLabel_W154">腾讯相关接口</span></a><button aria-label="Expand sidebar category &#x27;腾讯相关接口&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/微服务相关"><span title="微服务相关" class="categoryLinkLabel_W154">微服务相关</span></a><button aria-label="Expand sidebar category &#x27;微服务相关&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/javadoc/category/ddns"><span title="DDNS" class="categoryLinkLabel_W154">DDNS</span></a><button aria-label="Expand sidebar category &#x27;DDNS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/javadoc/java-async"><span title="Java异步解耦" class="linkLabel_WmDU">Java异步解耦</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/javadoc/java-CompletableFuture"><span title="Java多线程、异步" class="linkLabel_WmDU">Java多线程、异步</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/javadoc/category/消息队列相关"><span>消息队列相关</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">java rocketmq</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>java rocketmq</h1></header><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="java-rocketmq">java rocketmq<a href="#java-rocketmq" class="hash-link" aria-label="Direct link to java rocketmq" title="Direct link to java rocketmq" translate="no">​</a></h3>
<ul>
<li class=""><a href="https://rocketmq.apache.org/docs/quick-start/" target="_blank" rel="noopener noreferrer" class="">RocketMQ</a></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pomxml">pom.xml<a href="#pomxml" class="hash-link" aria-label="Direct link to pom.xml" title="Direct link to pom.xml" translate="no">​</a></h3>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.rocketmq</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">rocketmq-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2.3.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 兼容 JDK 8+，推荐版本 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="applicationyml">application.yml<a href="#applicationyml" class="hash-link" aria-label="Direct link to application.yml" title="Direct link to application.yml" translate="no">​</a></h3>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">rocketmq</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># NameServer 地址（必填）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name-server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.1.104</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9876;192.168.1.105</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9876</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 生产者配置（可选，但建议显式配置）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 生产者组名（必填！必须全局唯一）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> home_care_ry_producer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 消息发送超时时间（毫秒，默认 3000）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">send-message-timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 同步发送失败时重试次数（默认 2）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">retry-times-when-send-failed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 异步发送失败重试次数（默认 2）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">retry-times-when-send-async-failed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 最大消息大小（字节，默认 4MB = 4 * 1024 * 1024）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">max-message-size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4194304</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="消息发送服务示例">消息发送服务示例<a href="#消息发送服务示例" class="hash-link" aria-label="Direct link to 消息发送服务示例" title="Direct link to 消息发送服务示例" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.client.producer.SendCallback;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.client.producer.SendResult;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.common.message.MessageConst;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.core.RocketMQTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.messaging.Message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.messaging.support.MessageBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Service;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * RocketMQ 消息发送服务示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 提供多种消息发送方式：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 1. 同步发送：等待发送结果，适用于重要消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 2. 异步发送：不阻塞业务，通过回调处理结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 3. 单向发送：不关心结果，性能最高</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 4. 延迟发送：定时任务场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 5. 顺序发送：保证消息顺序消费</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 6. 事务发送：保证本地事务与消息发送的一致性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 7. 批量发送：提高吞吐量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;&lt;b&gt;使用示例：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;pre&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * {@code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * private OrderMessageService orderMessageService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * // 同步发送</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * orderMessageService.sendOrderCreated(order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * // 异步发送</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * orderMessageService.asyncSendOrderCreated(order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * // 延迟发送（10秒后）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * orderMessageService.sendDelayMessage(order, 3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/pre&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author ruoyi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderMessageService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private RocketMQTemplate rocketMQTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ==================== 基础发送 ====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 同步发送消息（推荐用于重要业务）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;会等待 Broker 返回结果，确保消息发送成功&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;订单创建、支付成功等重要业务通知&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单对象，会自动 JSON 序列化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void sendOrderCreated(Object order) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 同步发送，等待 Broker 返回结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SendResult sendResult = rocketMQTemplate.syncSend(&quot;ORDER_TOPIC&quot;, order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;订单消息发送成功，MsgId: {}, Status: {}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sendResult.getMsgId(), sendResult.getSendStatus());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;订单消息发送失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(&quot;消息发送失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 发送带 Tag 的消息（消费者可以按 Tag 过滤）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;同一 Topic 下区分不同业务类型&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param tag 消息标签（如：created、paid、cancelled）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void sendOrderWithTag(Object order, String tag) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Topic:Tag 格式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String destination = &quot;ORDER_TOPIC:&quot; + tag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SendResult sendResult = rocketMQTemplate.syncSend(destination, order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;带Tag消息发送成功，Tag: {}, MsgId: {}&quot;, tag, sendResult.getMsgId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;带Tag消息发送失败，Tag: {}&quot;, tag, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ==================== 异步发送 ====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 异步发送消息（推荐用于非关键路径）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;不阻塞当前线程，通过回调处理发送结果&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;日志记录、数据同步等对实时性要求不高的场景&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void asyncSendOrderCreated(Object order) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rocketMQTemplate.asyncSend(&quot;ORDER_TOPIC&quot;, order, new SendCallback() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            public void onSuccess(SendResult sendResult) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.info(&quot;异步消息发送成功，MsgId: {}, QueueId: {}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sendResult.getMsgId(), sendResult.getMessageQueue().getQueueId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            public void onException(Throwable e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.error(&quot;异步消息发送失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 可以在这里实现重试或补偿逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 异步发送带超时时间的消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param timeout 超时时间（毫秒）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void asyncSendWithTimeout(Object order, long timeout) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rocketMQTemplate.asyncSend(&quot;ORDER_TOPIC&quot;, order, new SendCallback() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            public void onSuccess(SendResult sendResult) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.info(&quot;异步消息发送成功: {}&quot;, sendResult.getMsgId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            public void onException(Throwable e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.error(&quot;异步消息发送失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }, timeout);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ==================== 单向发送 ====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 单向发送消息（性能最高，不关心结果）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;不等待 Broker 返回任何结果，性能最高但可靠性最低&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;日志采集、监控数据上报等允许丢失的场景&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void sendOneWay(Object order) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rocketMQTemplate.sendOneWay(&quot;ORDER_TOPIC&quot;, order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.debug(&quot;单向消息已发送（不保证送达）&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ==================== 延迟发送 ====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 发送延迟消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;延迟等级对照表：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;1: 1s&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;2: 5s&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;3: 10s&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;4: 30s&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;5: 1m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;6: 2m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;7: 3m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;8: 4m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;9: 5m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;10: 6m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;11: 7m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;12: 8m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;13: 9m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;14: 10m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;15: 20m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;16: 30m&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;17: 1h&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;18: 2h&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;订单超时取消、定时提醒等&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param delayLevel 延迟等级（1-18）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void sendDelayMessage(Object order, int delayLevel) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Message&lt;Object&gt; message = MessageBuilder.withPayload(order)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setHeader(MessageConst.PROPERTY_DELAY_TIME_LEVEL, delayLevel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SendResult sendResult = rocketMQTemplate.syncSend(&quot;DELAY_TOPIC&quot;, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;延迟消息发送成功，延迟等级: {}, MsgId: {}&quot;, delayLevel, sendResult.getMsgId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 发送延迟消息（便捷方法）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param delaySeconds 延迟秒数（1、5、10、30、60...）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void sendDelayMessageBySeconds(Object order, int delaySeconds) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int delayLevel = getDelayLevel(delaySeconds);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sendDelayMessage(order, delayLevel);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 将秒数转换为延迟等级</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int getDelayLevel(int seconds) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 1) return 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 5) return 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 10) return 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 30) return 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 60) return 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 120) return 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 180) return 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 240) return 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 300) return 9;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 360) return 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 420) return 11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 480) return 12;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 540) return 13;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 600) return 14;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 1200) return 15;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 1800) return 16;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (seconds &lt;= 3600) return 17;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return 18; // 2小时</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ==================== 顺序发送 ====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 发送顺序消息（保证同一 Key 的消息顺序消费）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;相同 hashKey 的消息会发送到同一队列，保证顺序消费&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;订单状态流转、库存操作等需要严格顺序的场景&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param orderId 订单ID（作为 hashKey）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void syncSendOrderly(Object order, String orderId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 第三个参数是 hashKey，相同 key 的消息会进入同一队列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SendResult sendResult = rocketMQTemplate.syncSendOrderly(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ORDER_STATUS_TOPIC&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            order, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            orderId // hashKey，相同 orderId 的消息保证顺序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;顺序消息发送成功，OrderId: {}, MsgId: {}, QueueId: {}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            orderId, sendResult.getMsgId(), sendResult.getMessageQueue().getQueueId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ==================== 带属性发送 ====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 发送带 Key 的消息（用于消息追踪和查询）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;通过 Key 可以在 RocketMQ 控制台快速查询消息&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;需要追踪的重要业务消息&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param messageKey 消息唯一标识（如订单号、流水号）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void syncSendWithKey(Object order, String messageKey) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Message&lt;Object&gt; message = MessageBuilder.withPayload(order)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .setHeader(MessageConst.PROPERTY_KEYS, messageKey) // 可用于控制台查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SendResult sendResult = rocketMQTemplate.syncSend(&quot;TRACE_TOPIC&quot;, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;带Key消息发送成功，Key: {}, MsgId: {}&quot;, messageKey, sendResult.getMsgId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 发送带自定义属性的消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param properties 自定义属性（如：业务类型、来源系统等）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void syncSendWithProperties(Object order, java.util.Map&lt;String, Object&gt; properties) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MessageBuilder&lt;Object&gt; builder = MessageBuilder.withPayload(order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 添加自定义属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (properties != null &amp;&amp; !properties.isEmpty()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            properties.forEach(builder::setHeader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SendResult sendResult = rocketMQTemplate.syncSend(&quot;ORDER_TOPIC&quot;, builder.build());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;带自定义属性消息发送成功，MsgId: {}&quot;, sendResult.getMsgId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ==================== 事务发送 ====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 发送事务消息（保证本地事务与消息发送的一致性）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;执行流程：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;ol&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;发送半消息（Half Message）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;执行本地事务（executeLocalTransaction）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;根据本地事务结果提交或回滚消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;如果长时间未收到结果，Broker 会回查本地事务状态（checkLocalTransaction）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;/ol&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;分布式事务、订单支付等需要保证一致性的场景&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param transactionId 事务ID（用于回查）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void sendTransaction(Object order, String transactionId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Message&lt;Object&gt; message = MessageBuilder.withPayload(order)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .setHeader(&quot;transactionId&quot;, transactionId) // 用于回查时识别事务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .setHeader(MessageConst.PROPERTY_KEYS, transactionId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rocketMQTemplate.sendMessageInTransaction(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;TX_ORDER_TOPIC&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                message,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                order // 传递给 executeLocalTransaction 的参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;事务消息已发送，TransactionId: {}&quot;, transactionId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ==================== 批量发送 ====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 批量发送消息（提高吞吐量）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;注意：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;批量消息不能是延迟消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;批量消息的总大小不能超过 4MB&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;批量消息需要配置相同的 Topic 和 Tag&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;批量数据同步、批量通知等&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param orders 订单列表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void sendBatch(java.util.List&lt;Object&gt; orders) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (orders == null || orders.isEmpty()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.warn(&quot;批量消息列表为空，跳过发送&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 构建批量消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            java.util.List&lt;Message&lt;Object&gt;&gt; messages = new java.util.ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (Object order : orders) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                messages.add(MessageBuilder.withPayload(order).build());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // RocketMQ Spring Boot 暂不直接支持批量发送，需要通过原生 API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 这里提供思路，实际使用需要注入 DefaultMQProducer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;批量消息准备发送，数量: {}&quot;, orders.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 逐个发送（实际项目中可以优化为真正的批量发送）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (Object order : orders) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                rocketMQTemplate.syncSend(&quot;ORDER_TOPIC&quot;, order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;批量消息发送完成，数量: {}&quot;, orders.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;批量消息发送失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(&quot;批量消息发送失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ==================== 请求-响应模式 ====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 发送请求消息并等待响应（RPC 模式）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;需要同步获取响应结果的场景&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param request 请求对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param timeout 超时时间（毫秒）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return 响应对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object sendAndReceive(Object request, long timeout) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Object response = rocketMQTemplate.sendAndReceive(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;REQUEST_TOPIC&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                request, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Object.class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                timeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;RPC请求成功，收到响应&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return response;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;RPC请求失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(&quot;RPC请求失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="消费者示例">消费者示例<a href="#消费者示例" class="hash-link" aria-label="Direct link to 消费者示例" title="Direct link to 消费者示例" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.annotation.ConsumeMode;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.annotation.MessageModel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.annotation.RocketMQMessageListener;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.annotation.SelectorType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.core.RocketMQListener;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * RocketMQ 消费者示例 - 订单消息消费</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;b&gt;消费者配置说明：&lt;/b&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&lt;b&gt;topic&lt;/b&gt;: 监听的主题名称&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&lt;b&gt;consumerGroup&lt;/b&gt;: 消费者组，必须全局唯一，建议命名：项目名_业务名_consumer&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&lt;b&gt;selectorType&lt;/b&gt;: 消息选择器类型（TAG 或 SQL92）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&lt;b&gt;selectorExpression&lt;/b&gt;: 过滤表达式，&quot;*&quot; 表示接收所有消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&lt;b&gt;consumeMode&lt;/b&gt;: 消费模式（并发 CONCURRENTLY 或顺序 ORDERLY）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&lt;b&gt;messageModel&lt;/b&gt;: 消息模式（集群 CLUSTERING 或广播 BROADCASTING）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&lt;b&gt;consumeThreadNumber&lt;/b&gt;: 消费线程数，默认 64&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&lt;b&gt;maxReconsumeTimes&lt;/b&gt;: 最大重试次数，默认 16&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;&lt;b&gt;使用注意事项：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ol&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;消费者组名必须全局唯一，不同消费者不能使用相同的组名&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;消费逻辑应实现幂等性，避免重复消费问题&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;消费失败时抛出异常，消息会自动重试&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;达到最大重试次数后，消息会进入死信队列（DLQ）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ol&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author ruoyi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RocketMQMessageListener(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topic = &quot;ORDER_TOPIC&quot;, // 监听的主题</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumerGroup = &quot;home_care_order_consumer&quot;, // 消费者组，全局唯一</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selectorType = SelectorType.TAG, // 按 Tag 过滤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selectorExpression = &quot;*&quot;, // &quot;*&quot; 表示接收所有 Tag，也可以指定：&quot;created || paid&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumeMode = ConsumeMode.CONCURRENTLY, // 并发消费（默认）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    messageModel = MessageModel.CLUSTERING, // 集群模式（默认）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumeThreadNumber = 20, // 消费线程数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxReconsumeTimes = 3 // 最大重试次数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderConsumer implements RocketMQListener&lt;Object&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 消费消息的核心方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;注意事项：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;此方法必须实现幂等性，即多次消费同一消息结果一致&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;消费成功则正常返回，失败抛出异常触发重试&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;达到最大重试次数后，消息进入死信队列：%DLQ%{consumerGroup}&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;避免耗时操作，建议单条消息处理时间 &lt; 5s&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param order 订单消息对象，会自动反序列化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onMessage(Object order) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;[OrderConsumer] 开始消费订单消息: {}&quot;, order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // TODO: 实现具体的订单处理逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 1. 校验消息合法性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 2. 幂等性处理（检查是否已处理）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 3. 执行业务逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 4. 记录处理状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 模拟业务处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            processOrder(order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;[OrderConsumer] 订单消息消费成功&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;[OrderConsumer] 订单消息消费失败，将触发重试&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 抛出异常，触发 RocketMQ 重试机制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(&quot;消息消费失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 处理订单逻辑（示例）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void processOrder(Object order) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 实际业务逻辑处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;处理订单业务逻辑: {}&quot;, order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="顺序消费者示例">顺序消费者示例<a href="#顺序消费者示例" class="hash-link" aria-label="Direct link to 顺序消费者示例" title="Direct link to 顺序消费者示例" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.annotation.ConsumeMode;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.annotation.MessageModel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.annotation.RocketMQMessageListener;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.core.RocketMQListener;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * RocketMQ 顺序消费者示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;b&gt;顺序消费特点：&lt;/b&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;消息按照发送顺序被消费（同一队列内）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;消费失败会阻塞队列，直到消费成功&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;适用于需要严格保证消息顺序的场景&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;订单状态流转（待支付 → 已支付 → 已发货 → 已完成）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;库存操作（扣减、回滚必须按顺序）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;账户流水（保证借贷记录顺序）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;&lt;b&gt;注意事项：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;顺序消费性能低于并发消费&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;消费失败会阻塞后续消息，需要特别注意异常处理&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;建议设置合理的消费超时时间&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author ruoyi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RocketMQMessageListener(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topic = &quot;ORDER_STATUS_TOPIC&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumerGroup = &quot;home_care_order_status_sequential_consumer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumeMode = ConsumeMode.ORDERLY, // 顺序消费模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    messageModel = MessageModel.CLUSTERING,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumeThreadNumber = 1 // 顺序消费建议设置为 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderSequentialConsumer implements RocketMQListener&lt;Object&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onMessage(Object message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;[OrderSequentialConsumer] 开始顺序消费消息: {}&quot;, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // TODO: 实现顺序处理逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 例如：处理订单状态变更</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            processOrderStatus(message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;[OrderSequentialConsumer] 消息消费成功&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;[OrderSequentialConsumer] 消息消费失败，将阻塞队列&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 顺序消费时，抛出异常会阻塞当前队列，直到消费成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(&quot;顺序消费失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 处理订单状态变更</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void processOrderStatus(Object message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;处理订单状态变更: {}&quot;, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 实现具体的业务逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="过滤消费者示例">过滤消费者示例<a href="#过滤消费者示例" class="hash-link" aria-label="Direct link to 过滤消费者示例" title="Direct link to 过滤消费者示例" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.annotation.RocketMQMessageListener;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.annotation.SelectorType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.core.RocketMQListener;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * RocketMQ Tag 过滤消费者示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;b&gt;Tag 过滤机制：&lt;/b&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;消费者可以通过 Tag 只接收特定类型的消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;支持单个 Tag 或多个 Tag（用 || 分隔）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;Broker 端过滤，减少网络传输&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;同一 Topic 下区分不同业务类型（如：订单创建、订单支付、订单完成）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;消费者只关心特定类型的消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;实现消息的精确订阅&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;&lt;b&gt;Tag 配置示例：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&quot;*&quot; - 接收所有消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&quot;created&quot; - 只接收 created 标签的消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&quot;created || paid&quot; - 接收 created 或 paid 标签的消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&quot;created || paid || cancelled&quot; - 接收三种标签的消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author ruoyi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RocketMQMessageListener(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topic = &quot;ORDER_TOPIC&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumerGroup = &quot;home_care_order_paid_consumer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selectorType = SelectorType.TAG,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    selectorExpression = &quot;paid || completed&quot; // 只接收 paid 和 completed 标签的消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderTagConsumer implements RocketMQListener&lt;Object&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onMessage(Object message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;[OrderTagConsumer] 接收到订单支付/完成消息: {}&quot;, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // TODO: 实现具体的业务逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 例如：发送通知、更新统计数据等</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            processPaymentOrCompletionMessage(message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;[OrderTagConsumer] 消息处理成功&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;[OrderTagConsumer] 消息处理失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(&quot;消息处理失败&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 处理支付或完成消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void processPaymentOrCompletionMessage(Object message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;处理订单支付/完成相关业务: {}&quot;, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 实现具体的业务逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="事务消息监听器示例">事务消息监听器示例<a href="#事务消息监听器示例" class="hash-link" aria-label="Direct link to 事务消息监听器示例" title="Direct link to 事务消息监听器示例" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.annotation.RocketMQTransactionListener;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.core.RocketMQLocalTransactionListener;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.rocketmq.spring.core.RocketMQLocalTransactionState;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.messaging.Message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.messaging.MessageHeaders;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * RocketMQ 事务消息监听器示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;b&gt;事务消息执行流程：&lt;/b&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ol&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;发送半消息（Half Message）到 Broker&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;执行本地事务（executeLocalTransaction）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;根据本地事务结果返回 COMMIT 或 ROLLBACK&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;如果返回 UNKNOWN 或长时间未响应，Broker 会调用 checkLocalTransaction 回查&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;根据回查结果决定是否提交消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ol&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;&lt;b&gt;三种事务状态：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&lt;b&gt;COMMIT&lt;/b&gt;: 提交事务，消息对消费者可见&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&lt;b&gt;ROLLBACK&lt;/b&gt;: 回滚事务，消息不会被消费&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;&lt;b&gt;UNKNOWN&lt;/b&gt;: 中间状态，需要 Broker 回查&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;&lt;b&gt;使用场景：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;订单创建后发送库存扣减消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;支付成功后发送通知消息&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;需要保证数据库操作与消息发送一致性的场景&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;p&gt;&lt;b&gt;配置说明：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;每个 Listener 只能绑定一个 Topic&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;如需多个 Topic 事务，需要创建多个 Listener&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   &lt;li&gt;通过 txProducerGroup 参数区分不同的事务发送者&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author ruoyi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RocketMQTransactionListener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderTransactionListener implements RocketMQLocalTransactionListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 执行本地事务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;此方法在半消息发送成功后立即调用&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;执行逻辑：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;ol&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;执行数据库操作（如扣库存、更新订单状态）&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;根据操作结果返回相应状态&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;如果不确定状态，返回 UNKNOWN，等待 Broker 回查&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;/ol&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;注意事项：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;此方法应该尽快执行完成，避免耗时操作&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;建议记录事务执行状态，便于回查&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;如果方法抛出异常，也会触发回查机制&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param msg 半消息对象，包含消息体和头信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param arg 发送消息时传入的额外参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return 本地事务执行状态：COMMIT、ROLLBACK 或 UNKNOWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RocketMQLocalTransactionState executeLocalTransaction(Message msg, Object arg) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 获取消息头信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MessageHeaders headers = msg.getHeaders();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String transactionId = (String) headers.get(&quot;transactionId&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;[TransactionListener] 开始执行本地事务，TransactionId: {}&quot;, transactionId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;[TransactionListener] 消息内容: {}&quot;, msg.getPayload());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;[TransactionListener] 额外参数: {}&quot;, arg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ==================== 执行本地事务 ====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // TODO: 实现具体的业务逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 示例：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 1. 执行数据库操作（扣库存、更新订单）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 2. 记录事务执行状态到数据库（用于回查）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 3. 根据执行结果决定返回状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            boolean success = executeBusinessLogic(transactionId, arg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (success) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.info(&quot;[TransactionListener] 本地事务执行成功，提交消息&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return RocketMQLocalTransactionState.COMMIT;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.warn(&quot;[TransactionListener] 本地事务执行失败，回滚消息&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return RocketMQLocalTransactionState.ROLLBACK;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;[TransactionListener] 本地事务执行异常，返回 UNKNOWN 等待回查&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 发生异常时，返回 UNKNOWN，等待 Broker 回查</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return RocketMQLocalTransactionState.UNKNOWN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 回查本地事务状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;当 executeLocalTransaction 返回 UNKNOWN 或超时时，Broker 会调用此方法回查&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;回查规则：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;首次回查间隔：6秒&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;后续回查间隔：60秒&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;最大回查次数：15次&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;超过最大次数后，消息会被丢弃&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;实现思路：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;ol&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;通过 transactionId 查询数据库事务状态表&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;根据记录的状态返回 COMMIT 或 ROLLBACK&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;如果找不到记录，可能是事务还在执行，返回 UNKNOWN&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;/ol&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;&lt;b&gt;注意事项：&lt;/b&gt;&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;回查方法应该尽快返回，避免耗时操作&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;回查逻辑应该是查询操作，不应该修改数据&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *   &lt;li&gt;如果不确定状态，可以继续返回 UNKNOWN，直到超过回查次数&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param msg 半消息对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return 事务状态：COMMIT、ROLLBACK 或 UNKNOWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RocketMQLocalTransactionState checkLocalTransaction(Message msg) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 获取事务ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MessageHeaders headers = msg.getHeaders();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String transactionId = (String) headers.get(&quot;transactionId&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;[TransactionListener] 回查本地事务状态，TransactionId: {}&quot;, transactionId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ==================== 查询事务状态 ====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // TODO: 从数据库查询事务执行状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 示例：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 1. 根据 transactionId 查询事务状态表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 2. 如果查询到事务成功记录，返回 COMMIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 3. 如果查询到事务失败记录，返回 ROLLBACK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 4. 如果查不到记录，可能还在执行，返回 UNKNOWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String status = checkTransactionStatus(transactionId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (&quot;SUCCESS&quot;.equals(status)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.info(&quot;[TransactionListener] 回查结果：事务已成功，提交消息&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return RocketMQLocalTransactionState.COMMIT;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else if (&quot;FAILED&quot;.equals(status)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.info(&quot;[TransactionListener] 回查结果：事务已失败，回滚消息&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return RocketMQLocalTransactionState.ROLLBACK;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log.info(&quot;[TransactionListener] 回查结果：事务状态未知，继续回查&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return RocketMQLocalTransactionState.UNKNOWN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(&quot;[TransactionListener] 回查本地事务状态异常&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 回查异常时，返回 UNKNOWN，等待下次回查</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return RocketMQLocalTransactionState.UNKNOWN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 执行具体的业务逻辑（示例）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param transactionId 事务ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param arg 额外参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return 是否成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private boolean executeBusinessLogic(String transactionId, Object arg) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // TODO: 实现具体的业务逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 示例：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 1. 执行数据库操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 2. 记录事务状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;执行业务逻辑，TransactionId: {}, Arg: {}&quot;, transactionId, arg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 模拟业务执行成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 查询事务状态（示例）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param transactionId 事务ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return 事务状态：SUCCESS、FAILED 或 UNKNOWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String checkTransactionStatus(String transactionId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // TODO: 从数据库查询事务状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 示例：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // SELECT status FROM transaction_log WHERE transaction_id = ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;查询事务状态，TransactionId: {}&quot;, transactionId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 模拟查询结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;SUCCESS&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/javadoc/tags/java">java</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs/javadoc/tags/rocketmq">rocketmq</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/LiangHChao/docs/edit/master/javadoc/mq/2026-01-22-rocket mq.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/javadoc/category/消息队列相关"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">消息队列相关</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/javadoc/category/mybatis-plus"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mybatis Plus</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#java-rocketmq" class="table-of-contents__link toc-highlight">java rocketmq</a></li><li><a href="#pomxml" class="table-of-contents__link toc-highlight">pom.xml</a></li><li><a href="#applicationyml" class="table-of-contents__link toc-highlight">application.yml</a></li><li><a href="#消息发送服务示例" class="table-of-contents__link toc-highlight">消息发送服务示例</a></li><li><a href="#消费者示例" class="table-of-contents__link toc-highlight">消费者示例</a></li><li><a href="#顺序消费者示例" class="table-of-contents__link toc-highlight">顺序消费者示例</a></li><li><a href="#过滤消费者示例" class="table-of-contents__link toc-highlight">过滤消费者示例</a></li><li><a href="#事务消息监听器示例" class="table-of-contents__link toc-highlight">事务消息监听器示例</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/docs/intro">文档</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://plus-doc.top/" target="_blank" rel="noopener noreferrer" class="footer__link-item">RuoYi-Plus<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://my.noip.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">no-ip<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/blog">博客</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dinosaurs<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>