---
slug: java-filter-interceptor-cors
title: 配置允许跨域
authors: [ lianghchao ]
tags: [ java,filter,interceptor, cors ]
---
### sping boot中配置允许跨域

### 添加WebMvcConfigurer跨域配置
```java
@Configuration
public static class WebConfig implements WebMvcConfigurer { // 改为 static

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**") // 拦截所有路径
                .allowedOriginPatterns("*") // 允许任意域名（Spring Boot 2.4+ 推荐用 allowedOriginPatterns）
                .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                .allowedHeaders("*")
                .allowCredentials(false) // 注意：如果设为 true，allowedOriginPatterns 不能为 "*"
                .maxAge(3600); // 预检请求缓存时间（秒）
    }
}
```
### 添加Filter跨域配置
- 优先级比WebMvcConfigurer高
- 如果没有自定义fileter，可不用添加
```java

@Component
@Order(Ordered.HIGHEST_PRECEDENCE)
public class SimpleCorsFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws ServletException, IOException {
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        // 只处理 CORS，不处理业务逻辑
        httpResponse.setHeader("Access-Control-Allow-Origin", "*");
        if ("OPTIONS".equals(httpRequest.getMethod())) {
            httpResponse.setStatus(200);
            return;
        }
        chain.doFilter(request, response);
    }
}
```

### 其他配置方式
- 覆盖默认配置
```java
@Bean
public CorsFilter corsFilter()
{
    CorsConfiguration config = new CorsConfiguration();
    // 允许所有域名进行跨域调用
//        config.addAllowedOrigin("localhost:*");
//        config.setAllowCredentials(true);
    // 设置访问源地址
    config.addAllowedOriginPattern("*");
    // 设置访问源请求头
    config.addAllowedHeader("*");
    // 设置访问源请求方法
    config.addAllowedMethod("*");
    // 有效期 1800秒
    config.setMaxAge(1800L);
    // 添加映射路径，拦截一切请求
    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    source.registerCorsConfiguration("/**", config);
    // 返回新的CorsFilter
    return new CorsFilter(source);
}
```

### 跨域生效测试
- 随便找个网站-F12-console
```js
fetch('http://localhost:8103/api/test', {
    method: 'GET',
    headers: {
        'Content-Type': 'application/json'
    }
})
    .then(res => res.json())
    .then(data => console.log('成功:', data))
    .catch(err => console.error('跨域失败:', err));
```