---
slug: java-Observer-patterns
title: è§‚å¯Ÿè€…æ¨¡å¼
authors: [ lianghchao ]
tags: [ java,design patterns ]
---
### è§‚å¯Ÿè€…æ¨¡å¼
- è§‚å¯Ÿè€…æ¨¡å¼ï¼Œä¹Ÿå«å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œæ˜¯ä¸€ç§ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä¸€ä¸ªå¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚
### å®šä¹‰äº‹ä»¶
```java
// OrderCreatedEvent.java
public static class OrderCreatedEvent extends ApplicationEvent {

    private final String orderId;
    private final String userId;

    public OrderCreatedEvent(Object source, String orderId, String userId) {
        super(source); // source é€šå¸¸æ˜¯å‘å¸ƒäº‹ä»¶çš„ bean
        this.orderId = orderId;
        this.userId = userId;
    }

    // Getters
    public String getOrderId() { return orderId; }
    public String getUserId() { return userId; }
}
```
```java

    @Data
    public static class Item{
        private String name;
    }
```
### å‘å¸ƒäº‹ä»¶
```java
    // OrderService.java
    @Service
    public static class OrderService {

        // Spring è‡ªåŠ¨æ³¨å…¥äº‹ä»¶å‘å¸ƒå™¨
        @Autowired
        private ApplicationEventPublisher eventPublisher;

        public void createOrder(String userId, List<Item> items) {
            // 1. åˆ›å»ºè®¢å•é€»è¾‘
            String orderId = saveOrder(userId, items);

            // 2. å‘å¸ƒäº‹ä»¶ï¼ ğŸ‘ˆ å…³é”®æ­¥éª¤
            eventPublisher.publishEvent(
                    new OrderCreatedEvent(this, orderId, userId)
            );

            // åç»­é€»è¾‘...
        }

        private String saveOrder(String userId, List<Item> items) {
            // ä¿å­˜åˆ°æ•°æ®åº“
            return "ORD-" + System.currentTimeMillis();
        }
    }

```
### ç›‘å¬å™¨
```java

    // EmailNotificationListener.java
    @Slf4j
    @Component
    public static class EmailNotificationListener {

//        private static final Logger log = LoggerFactory.getLogger(EmailNotificationListener.class);

        // ç›‘å¬ OrderCreatedEvent äº‹ä»¶
        @EventListener
        public void handleOrderCreated(OrderCreatedEvent event) {
            log.info("ğŸ“§ å‘é€é‚®ä»¶é€šçŸ¥: ç”¨æˆ· {} çš„è®¢å• {} å·²åˆ›å»º",
                    event.getUserId(), event.getOrderId());
            // å®é™…å‘é€é‚®ä»¶é€»è¾‘...
        }
    }
```
#### ç›‘å¬å™¨
```java

    // SmsNotificationListener.java
    @Component
    public static class SmsNotificationListener {

        @EventListener
        public void handleOrderCreated(OrderCreatedEvent event) {
            System.out.println("ğŸ“± å‘é€çŸ­ä¿¡é€šçŸ¥: è®¢å• " + event.getOrderId() + " å·²åˆ›å»º");
            // å®é™…å‘é€çŸ­ä¿¡é€»è¾‘...
        }
    }
```
#### ç›‘å¬å™¨
```java
    // InventoryUpdateListener.java
    @Component
    public static class InventoryUpdateListener {

        @EventListener
        public void updateInventory(OrderCreatedEvent event) {
            System.out.println("ğŸ“¦ æ‰£å‡åº“å­˜: å¤„ç†è®¢å• " + event.getOrderId());
            // æ‰£å‡å•†å“åº“å­˜...
        }
    }
```
### å®Œæ•´ä»£ç 
```java
@RestController
@SpringBootApplication
public class ObserverApplication {

    public static void main(String[] args) {
        SpringApplication.run(ObserverApplication.class, args);
    }

    // OrderCreatedEvent.java
    public static class OrderCreatedEvent extends ApplicationEvent {

        private final String orderId;
        private final String userId;

        public OrderCreatedEvent(Object source, String orderId, String userId) {
            super(source); // source é€šå¸¸æ˜¯å‘å¸ƒäº‹ä»¶çš„ bean
            this.orderId = orderId;
            this.userId = userId;
        }

        // Getters
        public String getOrderId() { return orderId; }
        public String getUserId() { return userId; }
    }
    @Data
    public static class Item{
        private String name;
    }

    // OrderService.java
    @Service
    public static class OrderService {

        // Spring è‡ªåŠ¨æ³¨å…¥äº‹ä»¶å‘å¸ƒå™¨
        @Autowired
        private ApplicationEventPublisher eventPublisher;

        public void createOrder(String userId, List<Item> items) {
            // 1. åˆ›å»ºè®¢å•é€»è¾‘
            String orderId = saveOrder(userId, items);

            // 2. å‘å¸ƒäº‹ä»¶ï¼ ğŸ‘ˆ å…³é”®æ­¥éª¤
            eventPublisher.publishEvent(
                    new OrderCreatedEvent(this, orderId, userId)
            );

            // åç»­é€»è¾‘...
        }

        private String saveOrder(String userId, List<Item> items) {
            // ä¿å­˜åˆ°æ•°æ®åº“
            return "ORD-" + System.currentTimeMillis();
        }
    }
    // EmailNotificationListener.java
    @Slf4j
    @Component
    public static class EmailNotificationListener {

//        private static final Logger log = LoggerFactory.getLogger(EmailNotificationListener.class);

        // ç›‘å¬ OrderCreatedEvent äº‹ä»¶
        @EventListener
        public void handleOrderCreated(OrderCreatedEvent event) {
            log.info("ğŸ“§ å‘é€é‚®ä»¶é€šçŸ¥: ç”¨æˆ· {} çš„è®¢å• {} å·²åˆ›å»º",
                    event.getUserId(), event.getOrderId());
            // å®é™…å‘é€é‚®ä»¶é€»è¾‘...
        }
    }
    // SmsNotificationListener.java
    @Component
    public static class SmsNotificationListener {

        @EventListener
        public void handleOrderCreated(OrderCreatedEvent event) {
            System.out.println("ğŸ“± å‘é€çŸ­ä¿¡é€šçŸ¥: è®¢å• " + event.getOrderId() + " å·²åˆ›å»º");
            // å®é™…å‘é€çŸ­ä¿¡é€»è¾‘...
        }
    }
    // InventoryUpdateListener.java
    @Component
    public static class InventoryUpdateListener {

        @EventListener
        public void updateInventory(OrderCreatedEvent event) {
            System.out.println("ğŸ“¦ æ‰£å‡åº“å­˜: å¤„ç†è®¢å• " + event.getOrderId());
            // æ‰£å‡å•†å“åº“å­˜...
        }
    }

    @Resource
    OrderService orderService;

    @PostMapping("/create-order")
    public String createOrder(@RequestBody List<Item> items) {
        orderService.createOrder("user-1", items);
        return "è®¢å•åˆ›å»ºæˆåŠŸï¼";
    }

}
```