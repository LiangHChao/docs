---
slug: springboot-auto mapping
title: 动态路由
authors: [ lianghchao ]
tags: [ java, spring boot ]
---
## 动态路由
- 什么？动态路由？第一次听说

### 定义接口
```java
public interface ITAfterSaleCommonService{

	boolean agree(Order order);

	boolean supports(Class<?> orderType);

}

```
### 实现案例1
```java
@Service
public class ExampleOrderServiceImpl implements ITAfterSaleCommonService {

    @Override
    @Transactional(rollbackFor = Exception.class)
    public boolean agree(Long id, Long userId) {
        return true;
    }
    
    @Override
    public boolean supports(Class<?> orderType) {
        return ExampleOrder.class.isAssignableFrom(orderType);
    }

}
```
### 接口实现2
```java
@Service
public class OrderServiceImpl implements ITAfterSaleCommonService {

    @Override
    @Transactional(rollbackFor = Exception.class)
    public boolean agree(Long id, Long userId) {
        return true;
    }
    
    @Override
    public boolean supports(Class<?> orderType) {
        return Order.class.isAssignableFrom(orderType);
    }

}
```
### 动态路由
```java
@Component
public class AfterSaleHandler {
    List<ITAfterSaleCommonService> handlers;
    public AfterSaleHandler(List<ITAfterSaleCommonService> handlers) {
        this.handlers = handlers;
    }
    // 动态路由入口
    public boolean agree(Object order) {
        if (order == null) throw new IllegalArgumentException("订单不能为空");

        // 遍历所有处理器，找到支持该订单类型的
        for (ITAfterSaleCommonService handler : handlers) {
            if (handler.supports(order.getClass())) {
                return handler.agree(id, userId);
            }
        }

        throw new UnsupportedOperationException("不支持的订单类型: " + order.getClass());
    }
}

```
### 使用
```java
@RestController
public class AfterSaleController {

    @Autowired
    private AfterSaleHandler router;

    public void agreeAfterSale(Long id, Long userId, Object order) {
        // 无论传入什么订单，自动路由到正确实现！
        boolean success = router.agree(id, userId, order);
        if (!success) {
            throw new RuntimeException("售后处理失败");
        }
    }
}
```

## 如果知道具体类型
```java
public interface ITAfterSaleCommonService<T> {

    boolean agree(T order);
}
```
```java
@Service
public class ExampleOrderServiceImpl implements ITAfterSaleCommonService<ExampleOrder> {

    @Override
    @Transactional(rollbackFor = Exception.class)
    public boolean agree(ExampleOrder order) {
        return true;
    }
}    
```
### 使用
```java
@RestController
public class AfterSaleController {

    @Autowired
    private ITAfterSaleCommonService router;

    public void agreeAfterSale(ExampleOrder order) {
        // 自动路由到正确实现！
        boolean success = router.agree(order);
        if (!success) {
            throw new RuntimeException("售后处理失败");
        }
    }
}
```