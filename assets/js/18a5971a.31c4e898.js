"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2316],{3808(n,e,r){r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"mq/2026-01-22-rocket mq","title":"java rocketmq","description":"pom.xml","source":"@site/javadoc/mq/2026-01-22-rocket mq.md","sourceDirName":"mq","slug":"/mq/java-rocketmq","permalink":"/docs/javadoc/mq/java-rocketmq","draft":false,"unlisted":false,"editUrl":"https://github.com/LiangHChao/docs/edit/master/javadoc/mq/2026-01-22-rocket mq.md","tags":[{"inline":true,"label":"java","permalink":"/docs/javadoc/tags/java"},{"inline":true,"label":"rocketmq","permalink":"/docs/javadoc/tags/rocketmq"}],"version":"current","frontMatter":{"slug":"java-rocketmq","title":"java rocketmq","authors":["lianghchao"],"tags":["java","rocketmq"]},"sidebar":"javaSidebar","previous":{"title":"\u6d88\u606f\u961f\u5217\u76f8\u5173","permalink":"/docs/javadoc/category/\u6d88\u606f\u961f\u5217\u76f8\u5173"},"next":{"title":"Mybatis Plus","permalink":"/docs/javadoc/category/mybatis-plus"}}');var t=r(4848),a=r(8453);const i={slug:"java-rocketmq",title:"java rocketmq",authors:["lianghchao"],tags:["java","rocketmq"]},s="java rocketmq",l={},c=[{value:"pom.xml",id:"pomxml",level:3},{value:"application.yml",id:"applicationyml",level:3},{value:"\u6d88\u606f\u53d1\u9001\u670d\u52a1\u793a\u4f8b",id:"\u6d88\u606f\u53d1\u9001\u670d\u52a1\u793a\u4f8b",level:3},{value:"\u6d88\u8d39\u8005\u793a\u4f8b",id:"\u6d88\u8d39\u8005\u793a\u4f8b",level:3},{value:"\u987a\u5e8f\u6d88\u8d39\u8005\u793a\u4f8b",id:"\u987a\u5e8f\u6d88\u8d39\u8005\u793a\u4f8b",level:3},{value:"\u8fc7\u6ee4\u6d88\u8d39\u8005\u793a\u4f8b",id:"\u8fc7\u6ee4\u6d88\u8d39\u8005\u793a\u4f8b",level:3},{value:"\u4e8b\u52a1\u6d88\u606f\u76d1\u542c\u5668\u793a\u4f8b",id:"\u4e8b\u52a1\u6d88\u606f\u76d1\u542c\u5668\u793a\u4f8b",level:3}];function d(n){const e={code:"code",h1:"h1",h3:"h3",header:"header",pre:"pre",...(0,a.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"java-rocketmq",children:"java rocketmq"})}),"\n",(0,t.jsx)(e.h3,{id:"pomxml",children:"pom.xml"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.jetbrains.kotlin</groupId>\n    <artifactId>kotlin-stdlib</artifactId>\n    <version>2.3.0</version> \x3c!-- \u517c\u5bb9 JDK 8+\uff0c\u63a8\u8350\u7248\u672c --\x3e\n</dependency>\n"})}),"\n",(0,t.jsx)(e.h3,{id:"applicationyml",children:"application.yml"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yml",children:"rocketmq:\n  # NameServer \u5730\u5740\uff08\u5fc5\u586b\uff09\n  name-server: 192.168.1.104:9876;192.168.1.105:9876\n  # \u751f\u4ea7\u8005\u914d\u7f6e\uff08\u53ef\u9009\uff0c\u4f46\u5efa\u8bae\u663e\u5f0f\u914d\u7f6e\uff09\n  producer:\n    # \u751f\u4ea7\u8005\u7ec4\u540d\uff08\u5fc5\u586b\uff01\u5fc5\u987b\u5168\u5c40\u552f\u4e00\uff09\n    group: home_care_ry_producer\n    # \u6d88\u606f\u53d1\u9001\u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff0c\u9ed8\u8ba4 3000\uff09\n    send-message-timeout: 3000\n    # \u540c\u6b65\u53d1\u9001\u5931\u8d25\u65f6\u91cd\u8bd5\u6b21\u6570\uff08\u9ed8\u8ba4 2\uff09\n    retry-times-when-send-failed: 2\n    # \u5f02\u6b65\u53d1\u9001\u5931\u8d25\u91cd\u8bd5\u6b21\u6570\uff08\u9ed8\u8ba4 2\uff09\n    retry-times-when-send-async-failed: 2\n    # \u6700\u5927\u6d88\u606f\u5927\u5c0f\uff08\u5b57\u8282\uff0c\u9ed8\u8ba4 4MB = 4 * 1024 * 1024\uff09\n    max-message-size: 4194304\n"})}),"\n",(0,t.jsx)(e.h3,{id:"\u6d88\u606f\u53d1\u9001\u670d\u52a1\u793a\u4f8b",children:"\u6d88\u606f\u53d1\u9001\u670d\u52a1\u793a\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'import lombok.extern.slf4j.Slf4j;\nimport org.apache.rocketmq.client.producer.SendCallback;\nimport org.apache.rocketmq.client.producer.SendResult;\nimport org.apache.rocketmq.common.message.MessageConst;\nimport org.apache.rocketmq.spring.core.RocketMQTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.messaging.Message;\nimport org.springframework.messaging.support.MessageBuilder;\nimport org.springframework.stereotype.Service;\n\n/**\n * RocketMQ \u6d88\u606f\u53d1\u9001\u670d\u52a1\u793a\u4f8b\n * <p>\n * \u63d0\u4f9b\u591a\u79cd\u6d88\u606f\u53d1\u9001\u65b9\u5f0f\uff1a\n * 1. \u540c\u6b65\u53d1\u9001\uff1a\u7b49\u5f85\u53d1\u9001\u7ed3\u679c\uff0c\u9002\u7528\u4e8e\u91cd\u8981\u6d88\u606f\n * 2. \u5f02\u6b65\u53d1\u9001\uff1a\u4e0d\u963b\u585e\u4e1a\u52a1\uff0c\u901a\u8fc7\u56de\u8c03\u5904\u7406\u7ed3\u679c\n * 3. \u5355\u5411\u53d1\u9001\uff1a\u4e0d\u5173\u5fc3\u7ed3\u679c\uff0c\u6027\u80fd\u6700\u9ad8\n * 4. \u5ef6\u8fdf\u53d1\u9001\uff1a\u5b9a\u65f6\u4efb\u52a1\u573a\u666f\n * 5. \u987a\u5e8f\u53d1\u9001\uff1a\u4fdd\u8bc1\u6d88\u606f\u987a\u5e8f\u6d88\u8d39\n * 6. \u4e8b\u52a1\u53d1\u9001\uff1a\u4fdd\u8bc1\u672c\u5730\u4e8b\u52a1\u4e0e\u6d88\u606f\u53d1\u9001\u7684\u4e00\u81f4\u6027\n * 7. \u6279\u91cf\u53d1\u9001\uff1a\u63d0\u9ad8\u541e\u5410\u91cf\n * </p>\n * \n * <p><b>\u4f7f\u7528\u793a\u4f8b\uff1a</b></p>\n * <pre>\n * {@code\n * @Autowired\n * private OrderMessageService orderMessageService;\n * \n * // \u540c\u6b65\u53d1\u9001\n * orderMessageService.sendOrderCreated(order);\n * \n * // \u5f02\u6b65\u53d1\u9001\n * orderMessageService.asyncSendOrderCreated(order);\n * \n * // \u5ef6\u8fdf\u53d1\u9001\uff0810\u79d2\u540e\uff09\n * orderMessageService.sendDelayMessage(order, 3);\n * }\n * </pre>\n *\n * @author ruoyi\n */\n@Service\n@Slf4j\npublic class OrderMessageService {\n\n    @Autowired\n    private RocketMQTemplate rocketMQTemplate;\n\n    // ==================== \u57fa\u7840\u53d1\u9001 ====================\n\n    /**\n     * \u540c\u6b65\u53d1\u9001\u6d88\u606f\uff08\u63a8\u8350\u7528\u4e8e\u91cd\u8981\u4e1a\u52a1\uff09\n     * <p>\u4f1a\u7b49\u5f85 Broker \u8fd4\u56de\u7ed3\u679c\uff0c\u786e\u4fdd\u6d88\u606f\u53d1\u9001\u6210\u529f</p>\n     * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b>\u8ba2\u5355\u521b\u5efa\u3001\u652f\u4ed8\u6210\u529f\u7b49\u91cd\u8981\u4e1a\u52a1\u901a\u77e5</p>\n     * \n     * @param order \u8ba2\u5355\u5bf9\u8c61\uff0c\u4f1a\u81ea\u52a8 JSON \u5e8f\u5217\u5316\n     */\n    public void sendOrderCreated(Object order) {\n        try {\n            // \u540c\u6b65\u53d1\u9001\uff0c\u7b49\u5f85 Broker \u8fd4\u56de\u7ed3\u679c\n            SendResult sendResult = rocketMQTemplate.syncSend("ORDER_TOPIC", order);\n            log.info("\u8ba2\u5355\u6d88\u606f\u53d1\u9001\u6210\u529f\uff0cMsgId: {}, Status: {}", \n                sendResult.getMsgId(), sendResult.getSendStatus());\n        } catch (Exception e) {\n            log.error("\u8ba2\u5355\u6d88\u606f\u53d1\u9001\u5931\u8d25", e);\n            throw new RuntimeException("\u6d88\u606f\u53d1\u9001\u5931\u8d25", e);\n        }\n    }\n\n    /**\n     * \u53d1\u9001\u5e26 Tag \u7684\u6d88\u606f\uff08\u6d88\u8d39\u8005\u53ef\u4ee5\u6309 Tag \u8fc7\u6ee4\uff09\n     * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b>\u540c\u4e00 Topic \u4e0b\u533a\u5206\u4e0d\u540c\u4e1a\u52a1\u7c7b\u578b</p>\n     * \n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     * @param tag \u6d88\u606f\u6807\u7b7e\uff08\u5982\uff1acreated\u3001paid\u3001cancelled\uff09\n     */\n    public void sendOrderWithTag(Object order, String tag) {\n        try {\n            // Topic:Tag \u683c\u5f0f\n            String destination = "ORDER_TOPIC:" + tag;\n            SendResult sendResult = rocketMQTemplate.syncSend(destination, order);\n            log.info("\u5e26Tag\u6d88\u606f\u53d1\u9001\u6210\u529f\uff0cTag: {}, MsgId: {}", tag, sendResult.getMsgId());\n        } catch (Exception e) {\n            log.error("\u5e26Tag\u6d88\u606f\u53d1\u9001\u5931\u8d25\uff0cTag: {}", tag, e);\n        }\n    }\n\n    // ==================== \u5f02\u6b65\u53d1\u9001 ====================\n\n    /**\n     * \u5f02\u6b65\u53d1\u9001\u6d88\u606f\uff08\u63a8\u8350\u7528\u4e8e\u975e\u5173\u952e\u8def\u5f84\uff09\n     * <p>\u4e0d\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff0c\u901a\u8fc7\u56de\u8c03\u5904\u7406\u53d1\u9001\u7ed3\u679c</p>\n     * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b>\u65e5\u5fd7\u8bb0\u5f55\u3001\u6570\u636e\u540c\u6b65\u7b49\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u573a\u666f</p>\n     * \n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     */\n    public void asyncSendOrderCreated(Object order) {\n        rocketMQTemplate.asyncSend("ORDER_TOPIC", order, new SendCallback() {\n            @Override\n            public void onSuccess(SendResult sendResult) {\n                log.info("\u5f02\u6b65\u6d88\u606f\u53d1\u9001\u6210\u529f\uff0cMsgId: {}, QueueId: {}", \n                    sendResult.getMsgId(), sendResult.getMessageQueue().getQueueId());\n            }\n\n            @Override\n            public void onException(Throwable e) {\n                log.error("\u5f02\u6b65\u6d88\u606f\u53d1\u9001\u5931\u8d25", e);\n                // \u53ef\u4ee5\u5728\u8fd9\u91cc\u5b9e\u73b0\u91cd\u8bd5\u6216\u8865\u507f\u903b\u8f91\n            }\n        });\n    }\n\n    /**\n     * \u5f02\u6b65\u53d1\u9001\u5e26\u8d85\u65f6\u65f6\u95f4\u7684\u6d88\u606f\n     * \n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     * @param timeout \u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff09\n     */\n    public void asyncSendWithTimeout(Object order, long timeout) {\n        rocketMQTemplate.asyncSend("ORDER_TOPIC", order, new SendCallback() {\n            @Override\n            public void onSuccess(SendResult sendResult) {\n                log.info("\u5f02\u6b65\u6d88\u606f\u53d1\u9001\u6210\u529f: {}", sendResult.getMsgId());\n            }\n\n            @Override\n            public void onException(Throwable e) {\n                log.error("\u5f02\u6b65\u6d88\u606f\u53d1\u9001\u5931\u8d25", e);\n            }\n        }, timeout);\n    }\n\n    // ==================== \u5355\u5411\u53d1\u9001 ====================\n\n    /**\n     * \u5355\u5411\u53d1\u9001\u6d88\u606f\uff08\u6027\u80fd\u6700\u9ad8\uff0c\u4e0d\u5173\u5fc3\u7ed3\u679c\uff09\n     * <p>\u4e0d\u7b49\u5f85 Broker \u8fd4\u56de\u4efb\u4f55\u7ed3\u679c\uff0c\u6027\u80fd\u6700\u9ad8\u4f46\u53ef\u9760\u6027\u6700\u4f4e</p>\n     * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b>\u65e5\u5fd7\u91c7\u96c6\u3001\u76d1\u63a7\u6570\u636e\u4e0a\u62a5\u7b49\u5141\u8bb8\u4e22\u5931\u7684\u573a\u666f</p>\n     * \n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     */\n    public void sendOneWay(Object order) {\n        rocketMQTemplate.sendOneWay("ORDER_TOPIC", order);\n        log.debug("\u5355\u5411\u6d88\u606f\u5df2\u53d1\u9001\uff08\u4e0d\u4fdd\u8bc1\u9001\u8fbe\uff09");\n    }\n\n    // ==================== \u5ef6\u8fdf\u53d1\u9001 ====================\n\n    /**\n     * \u53d1\u9001\u5ef6\u8fdf\u6d88\u606f\n     * <p><b>\u5ef6\u8fdf\u7b49\u7ea7\u5bf9\u7167\u8868\uff1a</b></p>\n     * <ul>\n     *   <li>1: 1s</li>\n     *   <li>2: 5s</li>\n     *   <li>3: 10s</li>\n     *   <li>4: 30s</li>\n     *   <li>5: 1m</li>\n     *   <li>6: 2m</li>\n     *   <li>7: 3m</li>\n     *   <li>8: 4m</li>\n     *   <li>9: 5m</li>\n     *   <li>10: 6m</li>\n     *   <li>11: 7m</li>\n     *   <li>12: 8m</li>\n     *   <li>13: 9m</li>\n     *   <li>14: 10m</li>\n     *   <li>15: 20m</li>\n     *   <li>16: 30m</li>\n     *   <li>17: 1h</li>\n     *   <li>18: 2h</li>\n     * </ul>\n     * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b>\u8ba2\u5355\u8d85\u65f6\u53d6\u6d88\u3001\u5b9a\u65f6\u63d0\u9192\u7b49</p>\n     * \n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     * @param delayLevel \u5ef6\u8fdf\u7b49\u7ea7\uff081-18\uff09\n     */\n    public void sendDelayMessage(Object order, int delayLevel) {\n        Message<Object> message = MessageBuilder.withPayload(order)\n                .setHeader(MessageConst.PROPERTY_DELAY_TIME_LEVEL, delayLevel)\n                .build();\n        \n        SendResult sendResult = rocketMQTemplate.syncSend("DELAY_TOPIC", message);\n        log.info("\u5ef6\u8fdf\u6d88\u606f\u53d1\u9001\u6210\u529f\uff0c\u5ef6\u8fdf\u7b49\u7ea7: {}, MsgId: {}", delayLevel, sendResult.getMsgId());\n    }\n\n    /**\n     * \u53d1\u9001\u5ef6\u8fdf\u6d88\u606f\uff08\u4fbf\u6377\u65b9\u6cd5\uff09\n     * \n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     * @param delaySeconds \u5ef6\u8fdf\u79d2\u6570\uff081\u30015\u300110\u300130\u300160...\uff09\n     */\n    public void sendDelayMessageBySeconds(Object order, int delaySeconds) {\n        int delayLevel = getDelayLevel(delaySeconds);\n        sendDelayMessage(order, delayLevel);\n    }\n\n    /**\n     * \u5c06\u79d2\u6570\u8f6c\u6362\u4e3a\u5ef6\u8fdf\u7b49\u7ea7\n     */\n    private int getDelayLevel(int seconds) {\n        if (seconds <= 1) return 1;\n        if (seconds <= 5) return 2;\n        if (seconds <= 10) return 3;\n        if (seconds <= 30) return 4;\n        if (seconds <= 60) return 5;\n        if (seconds <= 120) return 6;\n        if (seconds <= 180) return 7;\n        if (seconds <= 240) return 8;\n        if (seconds <= 300) return 9;\n        if (seconds <= 360) return 10;\n        if (seconds <= 420) return 11;\n        if (seconds <= 480) return 12;\n        if (seconds <= 540) return 13;\n        if (seconds <= 600) return 14;\n        if (seconds <= 1200) return 15;\n        if (seconds <= 1800) return 16;\n        if (seconds <= 3600) return 17;\n        return 18; // 2\u5c0f\u65f6\n    }\n    // ==================== \u987a\u5e8f\u53d1\u9001 ====================\n\n    /**\n     * \u53d1\u9001\u987a\u5e8f\u6d88\u606f\uff08\u4fdd\u8bc1\u540c\u4e00 Key \u7684\u6d88\u606f\u987a\u5e8f\u6d88\u8d39\uff09\n     * <p>\u76f8\u540c hashKey \u7684\u6d88\u606f\u4f1a\u53d1\u9001\u5230\u540c\u4e00\u961f\u5217\uff0c\u4fdd\u8bc1\u987a\u5e8f\u6d88\u8d39</p>\n     * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b>\u8ba2\u5355\u72b6\u6001\u6d41\u8f6c\u3001\u5e93\u5b58\u64cd\u4f5c\u7b49\u9700\u8981\u4e25\u683c\u987a\u5e8f\u7684\u573a\u666f</p>\n     * \n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     * @param orderId \u8ba2\u5355ID\uff08\u4f5c\u4e3a hashKey\uff09\n     */\n    public void syncSendOrderly(Object order, String orderId) {\n        // \u7b2c\u4e09\u4e2a\u53c2\u6570\u662f hashKey\uff0c\u76f8\u540c key \u7684\u6d88\u606f\u4f1a\u8fdb\u5165\u540c\u4e00\u961f\u5217\n        SendResult sendResult = rocketMQTemplate.syncSendOrderly(\n            "ORDER_STATUS_TOPIC", \n            order, \n            orderId // hashKey\uff0c\u76f8\u540c orderId \u7684\u6d88\u606f\u4fdd\u8bc1\u987a\u5e8f\n        );\n        log.info("\u987a\u5e8f\u6d88\u606f\u53d1\u9001\u6210\u529f\uff0cOrderId: {}, MsgId: {}, QueueId: {}", \n            orderId, sendResult.getMsgId(), sendResult.getMessageQueue().getQueueId());\n    }\n\n    // ==================== \u5e26\u5c5e\u6027\u53d1\u9001 ====================\n\n    /**\n     * \u53d1\u9001\u5e26 Key \u7684\u6d88\u606f\uff08\u7528\u4e8e\u6d88\u606f\u8ffd\u8e2a\u548c\u67e5\u8be2\uff09\n     * <p>\u901a\u8fc7 Key \u53ef\u4ee5\u5728 RocketMQ \u63a7\u5236\u53f0\u5feb\u901f\u67e5\u8be2\u6d88\u606f</p>\n     * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b>\u9700\u8981\u8ffd\u8e2a\u7684\u91cd\u8981\u4e1a\u52a1\u6d88\u606f</p>\n     * \n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     * @param messageKey \u6d88\u606f\u552f\u4e00\u6807\u8bc6\uff08\u5982\u8ba2\u5355\u53f7\u3001\u6d41\u6c34\u53f7\uff09\n     */\n    public void syncSendWithKey(Object order, String messageKey) {\n        Message<Object> message = MessageBuilder.withPayload(order)\n            .setHeader(MessageConst.PROPERTY_KEYS, messageKey) // \u53ef\u7528\u4e8e\u63a7\u5236\u53f0\u67e5\u8be2\n            .build();\n\n        SendResult sendResult = rocketMQTemplate.syncSend("TRACE_TOPIC", message);\n        log.info("\u5e26Key\u6d88\u606f\u53d1\u9001\u6210\u529f\uff0cKey: {}, MsgId: {}", messageKey, sendResult.getMsgId());\n    }\n\n    /**\n     * \u53d1\u9001\u5e26\u81ea\u5b9a\u4e49\u5c5e\u6027\u7684\u6d88\u606f\n     * \n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     * @param properties \u81ea\u5b9a\u4e49\u5c5e\u6027\uff08\u5982\uff1a\u4e1a\u52a1\u7c7b\u578b\u3001\u6765\u6e90\u7cfb\u7edf\u7b49\uff09\n     */\n    public void syncSendWithProperties(Object order, java.util.Map<String, Object> properties) {\n        MessageBuilder<Object> builder = MessageBuilder.withPayload(order);\n        \n        // \u6dfb\u52a0\u81ea\u5b9a\u4e49\u5c5e\u6027\n        if (properties != null && !properties.isEmpty()) {\n            properties.forEach(builder::setHeader);\n        }\n        \n        SendResult sendResult = rocketMQTemplate.syncSend("ORDER_TOPIC", builder.build());\n        log.info("\u5e26\u81ea\u5b9a\u4e49\u5c5e\u6027\u6d88\u606f\u53d1\u9001\u6210\u529f\uff0cMsgId: {}", sendResult.getMsgId());\n    }\n    // ==================== \u4e8b\u52a1\u53d1\u9001 ====================\n\n    /**\n     * \u53d1\u9001\u4e8b\u52a1\u6d88\u606f\uff08\u4fdd\u8bc1\u672c\u5730\u4e8b\u52a1\u4e0e\u6d88\u606f\u53d1\u9001\u7684\u4e00\u81f4\u6027\uff09\n     * <p><b>\u6267\u884c\u6d41\u7a0b\uff1a</b></p>\n     * <ol>\n     *   <li>\u53d1\u9001\u534a\u6d88\u606f\uff08Half Message\uff09</li>\n     *   <li>\u6267\u884c\u672c\u5730\u4e8b\u52a1\uff08executeLocalTransaction\uff09</li>\n     *   <li>\u6839\u636e\u672c\u5730\u4e8b\u52a1\u7ed3\u679c\u63d0\u4ea4\u6216\u56de\u6eda\u6d88\u606f</li>\n     *   <li>\u5982\u679c\u957f\u65f6\u95f4\u672a\u6536\u5230\u7ed3\u679c\uff0cBroker \u4f1a\u56de\u67e5\u672c\u5730\u4e8b\u52a1\u72b6\u6001\uff08checkLocalTransaction\uff09</li>\n     * </ol>\n     * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b>\u5206\u5e03\u5f0f\u4e8b\u52a1\u3001\u8ba2\u5355\u652f\u4ed8\u7b49\u9700\u8981\u4fdd\u8bc1\u4e00\u81f4\u6027\u7684\u573a\u666f</p>\n     * \n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     * @param transactionId \u4e8b\u52a1ID\uff08\u7528\u4e8e\u56de\u67e5\uff09\n     */\n    public void sendTransaction(Object order, String transactionId) {\n        Message<Object> message = MessageBuilder.withPayload(order)\n            .setHeader("transactionId", transactionId) // \u7528\u4e8e\u56de\u67e5\u65f6\u8bc6\u522b\u4e8b\u52a1\n            .setHeader(MessageConst.PROPERTY_KEYS, transactionId)\n            .build();\n        \n        rocketMQTemplate.sendMessageInTransaction(\n                "TX_ORDER_TOPIC",\n                message,\n                order // \u4f20\u9012\u7ed9 executeLocalTransaction \u7684\u53c2\u6570\n        );\n        log.info("\u4e8b\u52a1\u6d88\u606f\u5df2\u53d1\u9001\uff0cTransactionId: {}", transactionId);\n    }\n\n    // ==================== \u6279\u91cf\u53d1\u9001 ====================\n\n    /**\n     * \u6279\u91cf\u53d1\u9001\u6d88\u606f\uff08\u63d0\u9ad8\u541e\u5410\u91cf\uff09\n     * <p><b>\u6ce8\u610f\uff1a</b></p>\n     * <ul>\n     *   <li>\u6279\u91cf\u6d88\u606f\u4e0d\u80fd\u662f\u5ef6\u8fdf\u6d88\u606f</li>\n     *   <li>\u6279\u91cf\u6d88\u606f\u7684\u603b\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7 4MB</li>\n     *   <li>\u6279\u91cf\u6d88\u606f\u9700\u8981\u914d\u7f6e\u76f8\u540c\u7684 Topic \u548c Tag</li>\n     * </ul>\n     * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b>\u6279\u91cf\u6570\u636e\u540c\u6b65\u3001\u6279\u91cf\u901a\u77e5\u7b49</p>\n     * \n     * @param orders \u8ba2\u5355\u5217\u8868\n     */\n    public void sendBatch(java.util.List<Object> orders) {\n        if (orders == null || orders.isEmpty()) {\n            log.warn("\u6279\u91cf\u6d88\u606f\u5217\u8868\u4e3a\u7a7a\uff0c\u8df3\u8fc7\u53d1\u9001");\n            return;\n        }\n        \n        try {\n            // \u6784\u5efa\u6279\u91cf\u6d88\u606f\n            java.util.List<Message<Object>> messages = new java.util.ArrayList<>();\n            for (Object order : orders) {\n                messages.add(MessageBuilder.withPayload(order).build());\n            }\n            \n            // RocketMQ Spring Boot \u6682\u4e0d\u76f4\u63a5\u652f\u6301\u6279\u91cf\u53d1\u9001\uff0c\u9700\u8981\u901a\u8fc7\u539f\u751f API\n            // \u8fd9\u91cc\u63d0\u4f9b\u601d\u8def\uff0c\u5b9e\u9645\u4f7f\u7528\u9700\u8981\u6ce8\u5165 DefaultMQProducer\n            log.info("\u6279\u91cf\u6d88\u606f\u51c6\u5907\u53d1\u9001\uff0c\u6570\u91cf: {}", orders.size());\n            \n            // \u9010\u4e2a\u53d1\u9001\uff08\u5b9e\u9645\u9879\u76ee\u4e2d\u53ef\u4ee5\u4f18\u5316\u4e3a\u771f\u6b63\u7684\u6279\u91cf\u53d1\u9001\uff09\n            for (Object order : orders) {\n                rocketMQTemplate.syncSend("ORDER_TOPIC", order);\n            }\n            \n            log.info("\u6279\u91cf\u6d88\u606f\u53d1\u9001\u5b8c\u6210\uff0c\u6570\u91cf: {}", orders.size());\n        } catch (Exception e) {\n            log.error("\u6279\u91cf\u6d88\u606f\u53d1\u9001\u5931\u8d25", e);\n            throw new RuntimeException("\u6279\u91cf\u6d88\u606f\u53d1\u9001\u5931\u8d25", e);\n        }\n    }\n\n    // ==================== \u8bf7\u6c42-\u54cd\u5e94\u6a21\u5f0f ====================\n\n    /**\n     * \u53d1\u9001\u8bf7\u6c42\u6d88\u606f\u5e76\u7b49\u5f85\u54cd\u5e94\uff08RPC \u6a21\u5f0f\uff09\n     * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b>\u9700\u8981\u540c\u6b65\u83b7\u53d6\u54cd\u5e94\u7ed3\u679c\u7684\u573a\u666f</p>\n     * \n     * @param request \u8bf7\u6c42\u5bf9\u8c61\n     * @param timeout \u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff09\n     * @return \u54cd\u5e94\u5bf9\u8c61\n     */\n    public Object sendAndReceive(Object request, long timeout) {\n        try {\n            Object response = rocketMQTemplate.sendAndReceive(\n                "REQUEST_TOPIC", \n                request, \n                Object.class,\n                timeout\n            );\n            log.info("RPC\u8bf7\u6c42\u6210\u529f\uff0c\u6536\u5230\u54cd\u5e94");\n            return response;\n        } catch (Exception e) {\n            log.error("RPC\u8bf7\u6c42\u5931\u8d25", e);\n            throw new RuntimeException("RPC\u8bf7\u6c42\u5931\u8d25", e);\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"\u6d88\u8d39\u8005\u793a\u4f8b",children:"\u6d88\u8d39\u8005\u793a\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'import lombok.extern.slf4j.Slf4j;\nimport org.apache.rocketmq.spring.annotation.ConsumeMode;\nimport org.apache.rocketmq.spring.annotation.MessageModel;\nimport org.apache.rocketmq.spring.annotation.RocketMQMessageListener;\nimport org.apache.rocketmq.spring.annotation.SelectorType;\nimport org.apache.rocketmq.spring.core.RocketMQListener;\nimport org.springframework.stereotype.Component;\n\n/**\n * RocketMQ \u6d88\u8d39\u8005\u793a\u4f8b - \u8ba2\u5355\u6d88\u606f\u6d88\u8d39\n * <p>\n * <b>\u6d88\u8d39\u8005\u914d\u7f6e\u8bf4\u660e\uff1a</b>\n * <ul>\n *   <li><b>topic</b>: \u76d1\u542c\u7684\u4e3b\u9898\u540d\u79f0</li>\n *   <li><b>consumerGroup</b>: \u6d88\u8d39\u8005\u7ec4\uff0c\u5fc5\u987b\u5168\u5c40\u552f\u4e00\uff0c\u5efa\u8bae\u547d\u540d\uff1a\u9879\u76ee\u540d_\u4e1a\u52a1\u540d_consumer</li>\n *   <li><b>selectorType</b>: \u6d88\u606f\u9009\u62e9\u5668\u7c7b\u578b\uff08TAG \u6216 SQL92\uff09</li>\n *   <li><b>selectorExpression</b>: \u8fc7\u6ee4\u8868\u8fbe\u5f0f\uff0c"*" \u8868\u793a\u63a5\u6536\u6240\u6709\u6d88\u606f</li>\n *   <li><b>consumeMode</b>: \u6d88\u8d39\u6a21\u5f0f\uff08\u5e76\u53d1 CONCURRENTLY \u6216\u987a\u5e8f ORDERLY\uff09</li>\n *   <li><b>messageModel</b>: \u6d88\u606f\u6a21\u5f0f\uff08\u96c6\u7fa4 CLUSTERING \u6216\u5e7f\u64ad BROADCASTING\uff09</li>\n *   <li><b>consumeThreadNumber</b>: \u6d88\u8d39\u7ebf\u7a0b\u6570\uff0c\u9ed8\u8ba4 64</li>\n *   <li><b>maxReconsumeTimes</b>: \u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0c\u9ed8\u8ba4 16</li>\n * </ul>\n * </p>\n * \n * <p><b>\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879\uff1a</b></p>\n * <ol>\n *   <li>\u6d88\u8d39\u8005\u7ec4\u540d\u5fc5\u987b\u5168\u5c40\u552f\u4e00\uff0c\u4e0d\u540c\u6d88\u8d39\u8005\u4e0d\u80fd\u4f7f\u7528\u76f8\u540c\u7684\u7ec4\u540d</li>\n *   <li>\u6d88\u8d39\u903b\u8f91\u5e94\u5b9e\u73b0\u5e42\u7b49\u6027\uff0c\u907f\u514d\u91cd\u590d\u6d88\u8d39\u95ee\u9898</li>\n *   <li>\u6d88\u8d39\u5931\u8d25\u65f6\u629b\u51fa\u5f02\u5e38\uff0c\u6d88\u606f\u4f1a\u81ea\u52a8\u91cd\u8bd5</li>\n *   <li>\u8fbe\u5230\u6700\u5927\u91cd\u8bd5\u6b21\u6570\u540e\uff0c\u6d88\u606f\u4f1a\u8fdb\u5165\u6b7b\u4fe1\u961f\u5217\uff08DLQ\uff09</li>\n * </ol>\n * \n * @author ruoyi\n */\n@Slf4j\n@Component\n@RocketMQMessageListener(\n    topic = "ORDER_TOPIC", // \u76d1\u542c\u7684\u4e3b\u9898\n    consumerGroup = "home_care_order_consumer", // \u6d88\u8d39\u8005\u7ec4\uff0c\u5168\u5c40\u552f\u4e00\n    selectorType = SelectorType.TAG, // \u6309 Tag \u8fc7\u6ee4\n    selectorExpression = "*", // "*" \u8868\u793a\u63a5\u6536\u6240\u6709 Tag\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\uff1a"created || paid"\n    consumeMode = ConsumeMode.CONCURRENTLY, // \u5e76\u53d1\u6d88\u8d39\uff08\u9ed8\u8ba4\uff09\n    messageModel = MessageModel.CLUSTERING, // \u96c6\u7fa4\u6a21\u5f0f\uff08\u9ed8\u8ba4\uff09\n    consumeThreadNumber = 20, // \u6d88\u8d39\u7ebf\u7a0b\u6570\n    maxReconsumeTimes = 3 // \u6700\u5927\u91cd\u8bd5\u6b21\u6570\n)\npublic class OrderConsumer implements RocketMQListener<Object> {\n\n    /**\n     * \u6d88\u8d39\u6d88\u606f\u7684\u6838\u5fc3\u65b9\u6cd5\n     * <p><b>\u6ce8\u610f\u4e8b\u9879\uff1a</b></p>\n     * <ul>\n     *   <li>\u6b64\u65b9\u6cd5\u5fc5\u987b\u5b9e\u73b0\u5e42\u7b49\u6027\uff0c\u5373\u591a\u6b21\u6d88\u8d39\u540c\u4e00\u6d88\u606f\u7ed3\u679c\u4e00\u81f4</li>\n     *   <li>\u6d88\u8d39\u6210\u529f\u5219\u6b63\u5e38\u8fd4\u56de\uff0c\u5931\u8d25\u629b\u51fa\u5f02\u5e38\u89e6\u53d1\u91cd\u8bd5</li>\n     *   <li>\u8fbe\u5230\u6700\u5927\u91cd\u8bd5\u6b21\u6570\u540e\uff0c\u6d88\u606f\u8fdb\u5165\u6b7b\u4fe1\u961f\u5217\uff1a%DLQ%{consumerGroup}</li>\n     *   <li>\u907f\u514d\u8017\u65f6\u64cd\u4f5c\uff0c\u5efa\u8bae\u5355\u6761\u6d88\u606f\u5904\u7406\u65f6\u95f4 < 5s</li>\n     * </ul>\n     * \n     * @param order \u8ba2\u5355\u6d88\u606f\u5bf9\u8c61\uff0c\u4f1a\u81ea\u52a8\u53cd\u5e8f\u5217\u5316\n     */\n    @Override\n    public void onMessage(Object order) {\n        try {\n            log.info("[OrderConsumer] \u5f00\u59cb\u6d88\u8d39\u8ba2\u5355\u6d88\u606f: {}", order);\n            \n            // TODO: \u5b9e\u73b0\u5177\u4f53\u7684\u8ba2\u5355\u5904\u7406\u903b\u8f91\n            // 1. \u6821\u9a8c\u6d88\u606f\u5408\u6cd5\u6027\n            // 2. \u5e42\u7b49\u6027\u5904\u7406\uff08\u68c0\u67e5\u662f\u5426\u5df2\u5904\u7406\uff09\n            // 3. \u6267\u884c\u4e1a\u52a1\u903b\u8f91\n            // 4. \u8bb0\u5f55\u5904\u7406\u72b6\u6001\n            \n            // \u6a21\u62df\u4e1a\u52a1\u5904\u7406\n            processOrder(order);\n            \n            log.info("[OrderConsumer] \u8ba2\u5355\u6d88\u606f\u6d88\u8d39\u6210\u529f");\n            \n        } catch (Exception e) {\n            log.error("[OrderConsumer] \u8ba2\u5355\u6d88\u606f\u6d88\u8d39\u5931\u8d25\uff0c\u5c06\u89e6\u53d1\u91cd\u8bd5", e);\n            // \u629b\u51fa\u5f02\u5e38\uff0c\u89e6\u53d1 RocketMQ \u91cd\u8bd5\u673a\u5236\n            throw new RuntimeException("\u6d88\u606f\u6d88\u8d39\u5931\u8d25", e);\n        }\n    }\n    \n    /**\n     * \u5904\u7406\u8ba2\u5355\u903b\u8f91\uff08\u793a\u4f8b\uff09\n     */\n    private void processOrder(Object order) {\n        // \u5b9e\u9645\u4e1a\u52a1\u903b\u8f91\u5904\u7406\n        log.info("\u5904\u7406\u8ba2\u5355\u4e1a\u52a1\u903b\u8f91: {}", order);\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"\u987a\u5e8f\u6d88\u8d39\u8005\u793a\u4f8b",children:"\u987a\u5e8f\u6d88\u8d39\u8005\u793a\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'import lombok.extern.slf4j.Slf4j;\nimport org.apache.rocketmq.spring.annotation.ConsumeMode;\nimport org.apache.rocketmq.spring.annotation.MessageModel;\nimport org.apache.rocketmq.spring.annotation.RocketMQMessageListener;\nimport org.apache.rocketmq.spring.core.RocketMQListener;\nimport org.springframework.stereotype.Component;\n\n/**\n * RocketMQ \u987a\u5e8f\u6d88\u8d39\u8005\u793a\u4f8b\n * <p>\n * <b>\u987a\u5e8f\u6d88\u8d39\u7279\u70b9\uff1a</b>\n * <ul>\n *   <li>\u6d88\u606f\u6309\u7167\u53d1\u9001\u987a\u5e8f\u88ab\u6d88\u8d39\uff08\u540c\u4e00\u961f\u5217\u5185\uff09</li>\n *   <li>\u6d88\u8d39\u5931\u8d25\u4f1a\u963b\u585e\u961f\u5217\uff0c\u76f4\u5230\u6d88\u8d39\u6210\u529f</li>\n *   <li>\u9002\u7528\u4e8e\u9700\u8981\u4e25\u683c\u4fdd\u8bc1\u6d88\u606f\u987a\u5e8f\u7684\u573a\u666f</li>\n * </ul>\n * </p>\n * \n * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b></p>\n * <ul>\n *   <li>\u8ba2\u5355\u72b6\u6001\u6d41\u8f6c\uff08\u5f85\u652f\u4ed8 \u2192 \u5df2\u652f\u4ed8 \u2192 \u5df2\u53d1\u8d27 \u2192 \u5df2\u5b8c\u6210\uff09</li>\n *   <li>\u5e93\u5b58\u64cd\u4f5c\uff08\u6263\u51cf\u3001\u56de\u6eda\u5fc5\u987b\u6309\u987a\u5e8f\uff09</li>\n *   <li>\u8d26\u6237\u6d41\u6c34\uff08\u4fdd\u8bc1\u501f\u8d37\u8bb0\u5f55\u987a\u5e8f\uff09</li>\n * </ul>\n * \n * <p><b>\u6ce8\u610f\u4e8b\u9879\uff1a</b></p>\n * <ul>\n *   <li>\u987a\u5e8f\u6d88\u8d39\u6027\u80fd\u4f4e\u4e8e\u5e76\u53d1\u6d88\u8d39</li>\n *   <li>\u6d88\u8d39\u5931\u8d25\u4f1a\u963b\u585e\u540e\u7eed\u6d88\u606f\uff0c\u9700\u8981\u7279\u522b\u6ce8\u610f\u5f02\u5e38\u5904\u7406</li>\n *   <li>\u5efa\u8bae\u8bbe\u7f6e\u5408\u7406\u7684\u6d88\u8d39\u8d85\u65f6\u65f6\u95f4</li>\n * </ul>\n * \n * @author ruoyi\n */\n@Slf4j\n@Component\n@RocketMQMessageListener(\n    topic = "ORDER_STATUS_TOPIC",\n    consumerGroup = "home_care_order_status_sequential_consumer",\n    consumeMode = ConsumeMode.ORDERLY, // \u987a\u5e8f\u6d88\u8d39\u6a21\u5f0f\n    messageModel = MessageModel.CLUSTERING,\n    consumeThreadNumber = 1 // \u987a\u5e8f\u6d88\u8d39\u5efa\u8bae\u8bbe\u7f6e\u4e3a 1\n)\npublic class OrderSequentialConsumer implements RocketMQListener<Object> {\n\n    @Override\n    public void onMessage(Object message) {\n        try {\n            log.info("[OrderSequentialConsumer] \u5f00\u59cb\u987a\u5e8f\u6d88\u8d39\u6d88\u606f: {}", message);\n            \n            // TODO: \u5b9e\u73b0\u987a\u5e8f\u5904\u7406\u903b\u8f91\n            // \u4f8b\u5982\uff1a\u5904\u7406\u8ba2\u5355\u72b6\u6001\u53d8\u66f4\n            processOrderStatus(message);\n            \n            log.info("[OrderSequentialConsumer] \u6d88\u606f\u6d88\u8d39\u6210\u529f");\n            \n        } catch (Exception e) {\n            log.error("[OrderSequentialConsumer] \u6d88\u606f\u6d88\u8d39\u5931\u8d25\uff0c\u5c06\u963b\u585e\u961f\u5217", e);\n            // \u987a\u5e8f\u6d88\u8d39\u65f6\uff0c\u629b\u51fa\u5f02\u5e38\u4f1a\u963b\u585e\u5f53\u524d\u961f\u5217\uff0c\u76f4\u5230\u6d88\u8d39\u6210\u529f\n            throw new RuntimeException("\u987a\u5e8f\u6d88\u8d39\u5931\u8d25", e);\n        }\n    }\n    \n    /**\n     * \u5904\u7406\u8ba2\u5355\u72b6\u6001\u53d8\u66f4\n     */\n    private void processOrderStatus(Object message) {\n        log.info("\u5904\u7406\u8ba2\u5355\u72b6\u6001\u53d8\u66f4: {}", message);\n        // \u5b9e\u73b0\u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"\u8fc7\u6ee4\u6d88\u8d39\u8005\u793a\u4f8b",children:"\u8fc7\u6ee4\u6d88\u8d39\u8005\u793a\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'import lombok.extern.slf4j.Slf4j;\nimport org.apache.rocketmq.spring.annotation.RocketMQMessageListener;\nimport org.apache.rocketmq.spring.annotation.SelectorType;\nimport org.apache.rocketmq.spring.core.RocketMQListener;\nimport org.springframework.stereotype.Component;\n\n/**\n * RocketMQ Tag \u8fc7\u6ee4\u6d88\u8d39\u8005\u793a\u4f8b\n * <p>\n * <b>Tag \u8fc7\u6ee4\u673a\u5236\uff1a</b>\n * <ul>\n *   <li>\u6d88\u8d39\u8005\u53ef\u4ee5\u901a\u8fc7 Tag \u53ea\u63a5\u6536\u7279\u5b9a\u7c7b\u578b\u7684\u6d88\u606f</li>\n *   <li>\u652f\u6301\u5355\u4e2a Tag \u6216\u591a\u4e2a Tag\uff08\u7528 || \u5206\u9694\uff09</li>\n *   <li>Broker \u7aef\u8fc7\u6ee4\uff0c\u51cf\u5c11\u7f51\u7edc\u4f20\u8f93</li>\n * </ul>\n * </p>\n * \n * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b></p>\n * <ul>\n *   <li>\u540c\u4e00 Topic \u4e0b\u533a\u5206\u4e0d\u540c\u4e1a\u52a1\u7c7b\u578b\uff08\u5982\uff1a\u8ba2\u5355\u521b\u5efa\u3001\u8ba2\u5355\u652f\u4ed8\u3001\u8ba2\u5355\u5b8c\u6210\uff09</li>\n *   <li>\u6d88\u8d39\u8005\u53ea\u5173\u5fc3\u7279\u5b9a\u7c7b\u578b\u7684\u6d88\u606f</li>\n *   <li>\u5b9e\u73b0\u6d88\u606f\u7684\u7cbe\u786e\u8ba2\u9605</li>\n * </ul>\n * \n * <p><b>Tag \u914d\u7f6e\u793a\u4f8b\uff1a</b></p>\n * <ul>\n *   <li>"*" - \u63a5\u6536\u6240\u6709\u6d88\u606f</li>\n *   <li>"created" - \u53ea\u63a5\u6536 created \u6807\u7b7e\u7684\u6d88\u606f</li>\n *   <li>"created || paid" - \u63a5\u6536 created \u6216 paid \u6807\u7b7e\u7684\u6d88\u606f</li>\n *   <li>"created || paid || cancelled" - \u63a5\u6536\u4e09\u79cd\u6807\u7b7e\u7684\u6d88\u606f</li>\n * </ul>\n * \n * @author ruoyi\n */\n@Slf4j\n@Component\n@RocketMQMessageListener(\n    topic = "ORDER_TOPIC",\n    consumerGroup = "home_care_order_paid_consumer",\n    selectorType = SelectorType.TAG,\n    selectorExpression = "paid || completed" // \u53ea\u63a5\u6536 paid \u548c completed \u6807\u7b7e\u7684\u6d88\u606f\n)\npublic class OrderTagConsumer implements RocketMQListener<Object> {\n\n    @Override\n    public void onMessage(Object message) {\n        try {\n            log.info("[OrderTagConsumer] \u63a5\u6536\u5230\u8ba2\u5355\u652f\u4ed8/\u5b8c\u6210\u6d88\u606f: {}", message);\n            \n            // TODO: \u5b9e\u73b0\u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91\n            // \u4f8b\u5982\uff1a\u53d1\u9001\u901a\u77e5\u3001\u66f4\u65b0\u7edf\u8ba1\u6570\u636e\u7b49\n            processPaymentOrCompletionMessage(message);\n            \n            log.info("[OrderTagConsumer] \u6d88\u606f\u5904\u7406\u6210\u529f");\n            \n        } catch (Exception e) {\n            log.error("[OrderTagConsumer] \u6d88\u606f\u5904\u7406\u5931\u8d25", e);\n            throw new RuntimeException("\u6d88\u606f\u5904\u7406\u5931\u8d25", e);\n        }\n    }\n    \n    /**\n     * \u5904\u7406\u652f\u4ed8\u6216\u5b8c\u6210\u6d88\u606f\n     */\n    private void processPaymentOrCompletionMessage(Object message) {\n        log.info("\u5904\u7406\u8ba2\u5355\u652f\u4ed8/\u5b8c\u6210\u76f8\u5173\u4e1a\u52a1: {}", message);\n        // \u5b9e\u73b0\u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"\u4e8b\u52a1\u6d88\u606f\u76d1\u542c\u5668\u793a\u4f8b",children:"\u4e8b\u52a1\u6d88\u606f\u76d1\u542c\u5668\u793a\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'import lombok.extern.slf4j.Slf4j;\nimport org.apache.rocketmq.spring.annotation.RocketMQTransactionListener;\nimport org.apache.rocketmq.spring.core.RocketMQLocalTransactionListener;\nimport org.apache.rocketmq.spring.core.RocketMQLocalTransactionState;\nimport org.springframework.messaging.Message;\nimport org.springframework.messaging.MessageHeaders;\n\n/**\n * RocketMQ \u4e8b\u52a1\u6d88\u606f\u76d1\u542c\u5668\u793a\u4f8b\n * <p>\n * <b>\u4e8b\u52a1\u6d88\u606f\u6267\u884c\u6d41\u7a0b\uff1a</b>\n * <ol>\n *   <li>\u53d1\u9001\u534a\u6d88\u606f\uff08Half Message\uff09\u5230 Broker</li>\n *   <li>\u6267\u884c\u672c\u5730\u4e8b\u52a1\uff08executeLocalTransaction\uff09</li>\n *   <li>\u6839\u636e\u672c\u5730\u4e8b\u52a1\u7ed3\u679c\u8fd4\u56de COMMIT \u6216 ROLLBACK</li>\n *   <li>\u5982\u679c\u8fd4\u56de UNKNOWN \u6216\u957f\u65f6\u95f4\u672a\u54cd\u5e94\uff0cBroker \u4f1a\u8c03\u7528 checkLocalTransaction \u56de\u67e5</li>\n *   <li>\u6839\u636e\u56de\u67e5\u7ed3\u679c\u51b3\u5b9a\u662f\u5426\u63d0\u4ea4\u6d88\u606f</li>\n * </ol>\n * </p>\n * \n * <p><b>\u4e09\u79cd\u4e8b\u52a1\u72b6\u6001\uff1a</b></p>\n * <ul>\n *   <li><b>COMMIT</b>: \u63d0\u4ea4\u4e8b\u52a1\uff0c\u6d88\u606f\u5bf9\u6d88\u8d39\u8005\u53ef\u89c1</li>\n *   <li><b>ROLLBACK</b>: \u56de\u6eda\u4e8b\u52a1\uff0c\u6d88\u606f\u4e0d\u4f1a\u88ab\u6d88\u8d39</li>\n *   <li><b>UNKNOWN</b>: \u4e2d\u95f4\u72b6\u6001\uff0c\u9700\u8981 Broker \u56de\u67e5</li>\n * </ul>\n * \n * <p><b>\u4f7f\u7528\u573a\u666f\uff1a</b></p>\n * <ul>\n *   <li>\u8ba2\u5355\u521b\u5efa\u540e\u53d1\u9001\u5e93\u5b58\u6263\u51cf\u6d88\u606f</li>\n *   <li>\u652f\u4ed8\u6210\u529f\u540e\u53d1\u9001\u901a\u77e5\u6d88\u606f</li>\n *   <li>\u9700\u8981\u4fdd\u8bc1\u6570\u636e\u5e93\u64cd\u4f5c\u4e0e\u6d88\u606f\u53d1\u9001\u4e00\u81f4\u6027\u7684\u573a\u666f</li>\n * </ul>\n * \n * <p><b>\u914d\u7f6e\u8bf4\u660e\uff1a</b></p>\n * <ul>\n *   <li>\u6bcf\u4e2a Listener \u53ea\u80fd\u7ed1\u5b9a\u4e00\u4e2a Topic</li>\n *   <li>\u5982\u9700\u591a\u4e2a Topic \u4e8b\u52a1\uff0c\u9700\u8981\u521b\u5efa\u591a\u4e2a Listener</li>\n *   <li>\u901a\u8fc7 txProducerGroup \u53c2\u6570\u533a\u5206\u4e0d\u540c\u7684\u4e8b\u52a1\u53d1\u9001\u8005</li>\n * </ul>\n * \n * @author ruoyi\n */\n@Slf4j\n@RocketMQTransactionListener\npublic class OrderTransactionListener implements RocketMQLocalTransactionListener {\n\n    /**\n     * \u6267\u884c\u672c\u5730\u4e8b\u52a1\n     * <p>\u6b64\u65b9\u6cd5\u5728\u534a\u6d88\u606f\u53d1\u9001\u6210\u529f\u540e\u7acb\u5373\u8c03\u7528</p>\n     * \n     * <p><b>\u6267\u884c\u903b\u8f91\uff1a</b></p>\n     * <ol>\n     *   <li>\u6267\u884c\u6570\u636e\u5e93\u64cd\u4f5c\uff08\u5982\u6263\u5e93\u5b58\u3001\u66f4\u65b0\u8ba2\u5355\u72b6\u6001\uff09</li>\n     *   <li>\u6839\u636e\u64cd\u4f5c\u7ed3\u679c\u8fd4\u56de\u76f8\u5e94\u72b6\u6001</li>\n     *   <li>\u5982\u679c\u4e0d\u786e\u5b9a\u72b6\u6001\uff0c\u8fd4\u56de UNKNOWN\uff0c\u7b49\u5f85 Broker \u56de\u67e5</li>\n     * </ol>\n     * \n     * <p><b>\u6ce8\u610f\u4e8b\u9879\uff1a</b></p>\n     * <ul>\n     *   <li>\u6b64\u65b9\u6cd5\u5e94\u8be5\u5c3d\u5feb\u6267\u884c\u5b8c\u6210\uff0c\u907f\u514d\u8017\u65f6\u64cd\u4f5c</li>\n     *   <li>\u5efa\u8bae\u8bb0\u5f55\u4e8b\u52a1\u6267\u884c\u72b6\u6001\uff0c\u4fbf\u4e8e\u56de\u67e5</li>\n     *   <li>\u5982\u679c\u65b9\u6cd5\u629b\u51fa\u5f02\u5e38\uff0c\u4e5f\u4f1a\u89e6\u53d1\u56de\u67e5\u673a\u5236</li>\n     * </ul>\n     * \n     * @param msg \u534a\u6d88\u606f\u5bf9\u8c61\uff0c\u5305\u542b\u6d88\u606f\u4f53\u548c\u5934\u4fe1\u606f\n     * @param arg \u53d1\u9001\u6d88\u606f\u65f6\u4f20\u5165\u7684\u989d\u5916\u53c2\u6570\n     * @return \u672c\u5730\u4e8b\u52a1\u6267\u884c\u72b6\u6001\uff1aCOMMIT\u3001ROLLBACK \u6216 UNKNOWN\n     */\n    @Override\n    public RocketMQLocalTransactionState executeLocalTransaction(Message msg, Object arg) {\n        try {\n            // \u83b7\u53d6\u6d88\u606f\u5934\u4fe1\u606f\n            MessageHeaders headers = msg.getHeaders();\n            String transactionId = (String) headers.get("transactionId");\n            \n            log.info("[TransactionListener] \u5f00\u59cb\u6267\u884c\u672c\u5730\u4e8b\u52a1\uff0cTransactionId: {}", transactionId);\n            log.info("[TransactionListener] \u6d88\u606f\u5185\u5bb9: {}", msg.getPayload());\n            log.info("[TransactionListener] \u989d\u5916\u53c2\u6570: {}", arg);\n            \n            // ==================== \u6267\u884c\u672c\u5730\u4e8b\u52a1 ====================\n            // TODO: \u5b9e\u73b0\u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91\n            // \u793a\u4f8b\uff1a\n            // 1. \u6267\u884c\u6570\u636e\u5e93\u64cd\u4f5c\uff08\u6263\u5e93\u5b58\u3001\u66f4\u65b0\u8ba2\u5355\uff09\n            // 2. \u8bb0\u5f55\u4e8b\u52a1\u6267\u884c\u72b6\u6001\u5230\u6570\u636e\u5e93\uff08\u7528\u4e8e\u56de\u67e5\uff09\n            // 3. \u6839\u636e\u6267\u884c\u7ed3\u679c\u51b3\u5b9a\u8fd4\u56de\u72b6\u6001\n            \n            boolean success = executeBusinessLogic(transactionId, arg);\n            \n            if (success) {\n                log.info("[TransactionListener] \u672c\u5730\u4e8b\u52a1\u6267\u884c\u6210\u529f\uff0c\u63d0\u4ea4\u6d88\u606f");\n                return RocketMQLocalTransactionState.COMMIT;\n            } else {\n                log.warn("[TransactionListener] \u672c\u5730\u4e8b\u52a1\u6267\u884c\u5931\u8d25\uff0c\u56de\u6eda\u6d88\u606f");\n                return RocketMQLocalTransactionState.ROLLBACK;\n            }\n            \n        } catch (Exception e) {\n            log.error("[TransactionListener] \u672c\u5730\u4e8b\u52a1\u6267\u884c\u5f02\u5e38\uff0c\u8fd4\u56de UNKNOWN \u7b49\u5f85\u56de\u67e5", e);\n            // \u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u8fd4\u56de UNKNOWN\uff0c\u7b49\u5f85 Broker \u56de\u67e5\n            return RocketMQLocalTransactionState.UNKNOWN;\n        }\n    }\n\n    /**\n     * \u56de\u67e5\u672c\u5730\u4e8b\u52a1\u72b6\u6001\n     * <p>\u5f53 executeLocalTransaction \u8fd4\u56de UNKNOWN \u6216\u8d85\u65f6\u65f6\uff0cBroker \u4f1a\u8c03\u7528\u6b64\u65b9\u6cd5\u56de\u67e5</p>\n     * \n     * <p><b>\u56de\u67e5\u89c4\u5219\uff1a</b></p>\n     * <ul>\n     *   <li>\u9996\u6b21\u56de\u67e5\u95f4\u9694\uff1a6\u79d2</li>\n     *   <li>\u540e\u7eed\u56de\u67e5\u95f4\u9694\uff1a60\u79d2</li>\n     *   <li>\u6700\u5927\u56de\u67e5\u6b21\u6570\uff1a15\u6b21</li>\n     *   <li>\u8d85\u8fc7\u6700\u5927\u6b21\u6570\u540e\uff0c\u6d88\u606f\u4f1a\u88ab\u4e22\u5f03</li>\n     * </ul>\n     * \n     * <p><b>\u5b9e\u73b0\u601d\u8def\uff1a</b></p>\n     * <ol>\n     *   <li>\u901a\u8fc7 transactionId \u67e5\u8be2\u6570\u636e\u5e93\u4e8b\u52a1\u72b6\u6001\u8868</li>\n     *   <li>\u6839\u636e\u8bb0\u5f55\u7684\u72b6\u6001\u8fd4\u56de COMMIT \u6216 ROLLBACK</li>\n     *   <li>\u5982\u679c\u627e\u4e0d\u5230\u8bb0\u5f55\uff0c\u53ef\u80fd\u662f\u4e8b\u52a1\u8fd8\u5728\u6267\u884c\uff0c\u8fd4\u56de UNKNOWN</li>\n     * </ol>\n     * \n     * <p><b>\u6ce8\u610f\u4e8b\u9879\uff1a</b></p>\n     * <ul>\n     *   <li>\u56de\u67e5\u65b9\u6cd5\u5e94\u8be5\u5c3d\u5feb\u8fd4\u56de\uff0c\u907f\u514d\u8017\u65f6\u64cd\u4f5c</li>\n     *   <li>\u56de\u67e5\u903b\u8f91\u5e94\u8be5\u662f\u67e5\u8be2\u64cd\u4f5c\uff0c\u4e0d\u5e94\u8be5\u4fee\u6539\u6570\u636e</li>\n     *   <li>\u5982\u679c\u4e0d\u786e\u5b9a\u72b6\u6001\uff0c\u53ef\u4ee5\u7ee7\u7eed\u8fd4\u56de UNKNOWN\uff0c\u76f4\u5230\u8d85\u8fc7\u56de\u67e5\u6b21\u6570</li>\n     * </ul>\n     * \n     * @param msg \u534a\u6d88\u606f\u5bf9\u8c61\n     * @return \u4e8b\u52a1\u72b6\u6001\uff1aCOMMIT\u3001ROLLBACK \u6216 UNKNOWN\n     */\n    @Override\n    public RocketMQLocalTransactionState checkLocalTransaction(Message msg) {\n        try {\n            // \u83b7\u53d6\u4e8b\u52a1ID\n            MessageHeaders headers = msg.getHeaders();\n            String transactionId = (String) headers.get("transactionId");\n            \n            log.info("[TransactionListener] \u56de\u67e5\u672c\u5730\u4e8b\u52a1\u72b6\u6001\uff0cTransactionId: {}", transactionId);\n            \n            // ==================== \u67e5\u8be2\u4e8b\u52a1\u72b6\u6001 ====================\n            // TODO: \u4ece\u6570\u636e\u5e93\u67e5\u8be2\u4e8b\u52a1\u6267\u884c\u72b6\u6001\n            // \u793a\u4f8b\uff1a\n            // 1. \u6839\u636e transactionId \u67e5\u8be2\u4e8b\u52a1\u72b6\u6001\u8868\n            // 2. \u5982\u679c\u67e5\u8be2\u5230\u4e8b\u52a1\u6210\u529f\u8bb0\u5f55\uff0c\u8fd4\u56de COMMIT\n            // 3. \u5982\u679c\u67e5\u8be2\u5230\u4e8b\u52a1\u5931\u8d25\u8bb0\u5f55\uff0c\u8fd4\u56de ROLLBACK\n            // 4. \u5982\u679c\u67e5\u4e0d\u5230\u8bb0\u5f55\uff0c\u53ef\u80fd\u8fd8\u5728\u6267\u884c\uff0c\u8fd4\u56de UNKNOWN\n            \n            String status = checkTransactionStatus(transactionId);\n            \n            if ("SUCCESS".equals(status)) {\n                log.info("[TransactionListener] \u56de\u67e5\u7ed3\u679c\uff1a\u4e8b\u52a1\u5df2\u6210\u529f\uff0c\u63d0\u4ea4\u6d88\u606f");\n                return RocketMQLocalTransactionState.COMMIT;\n            } else if ("FAILED".equals(status)) {\n                log.info("[TransactionListener] \u56de\u67e5\u7ed3\u679c\uff1a\u4e8b\u52a1\u5df2\u5931\u8d25\uff0c\u56de\u6eda\u6d88\u606f");\n                return RocketMQLocalTransactionState.ROLLBACK;\n            } else {\n                log.info("[TransactionListener] \u56de\u67e5\u7ed3\u679c\uff1a\u4e8b\u52a1\u72b6\u6001\u672a\u77e5\uff0c\u7ee7\u7eed\u56de\u67e5");\n                return RocketMQLocalTransactionState.UNKNOWN;\n            }\n            \n        } catch (Exception e) {\n            log.error("[TransactionListener] \u56de\u67e5\u672c\u5730\u4e8b\u52a1\u72b6\u6001\u5f02\u5e38", e);\n            // \u56de\u67e5\u5f02\u5e38\u65f6\uff0c\u8fd4\u56de UNKNOWN\uff0c\u7b49\u5f85\u4e0b\u6b21\u56de\u67e5\n            return RocketMQLocalTransactionState.UNKNOWN;\n        }\n    }\n    \n    /**\n     * \u6267\u884c\u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91\uff08\u793a\u4f8b\uff09\n     * \n     * @param transactionId \u4e8b\u52a1ID\n     * @param arg \u989d\u5916\u53c2\u6570\n     * @return \u662f\u5426\u6210\u529f\n     */\n    private boolean executeBusinessLogic(String transactionId, Object arg) {\n        // TODO: \u5b9e\u73b0\u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91\n        // \u793a\u4f8b\uff1a\n        // 1. \u6267\u884c\u6570\u636e\u5e93\u64cd\u4f5c\n        // 2. \u8bb0\u5f55\u4e8b\u52a1\u72b6\u6001\n        \n        log.info("\u6267\u884c\u4e1a\u52a1\u903b\u8f91\uff0cTransactionId: {}, Arg: {}", transactionId, arg);\n        \n        // \u6a21\u62df\u4e1a\u52a1\u6267\u884c\u6210\u529f\n        return true;\n    }\n    \n    /**\n     * \u67e5\u8be2\u4e8b\u52a1\u72b6\u6001\uff08\u793a\u4f8b\uff09\n     * \n     * @param transactionId \u4e8b\u52a1ID\n     * @return \u4e8b\u52a1\u72b6\u6001\uff1aSUCCESS\u3001FAILED \u6216 UNKNOWN\n     */\n    private String checkTransactionStatus(String transactionId) {\n        // TODO: \u4ece\u6570\u636e\u5e93\u67e5\u8be2\u4e8b\u52a1\u72b6\u6001\n        // \u793a\u4f8b\uff1a\n        // SELECT status FROM transaction_log WHERE transaction_id = ?\n        \n        log.info("\u67e5\u8be2\u4e8b\u52a1\u72b6\u6001\uff0cTransactionId: {}", transactionId);\n        \n        // \u6a21\u62df\u67e5\u8be2\u7ed3\u679c\n        return "SUCCESS";\n    }\n}\n'})})]})}function p(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453(n,e,r){r.d(e,{R:()=>i,x:()=>s});var o=r(6540);const t={},a=o.createContext(t);function i(n){const e=o.useContext(a);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:i(n.components),o.createElement(a.Provider,{value:e},n.children)}}}]);