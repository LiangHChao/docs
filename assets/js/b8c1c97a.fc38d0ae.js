"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1217],{4347(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>p});var r=t(5856),o=t(4848),s=t(8453);const i={slug:"java-filter-interceptor",title:"\u8fc7\u6ee4\u5668&\u62e6\u622a\u5668",authors:["lianghchao"],tags:["java","filter","interceptor"]},l=void 0,a={authorsImageUrls:[void 0]},p=[{value:"sping boot\u4e2d\u7684\u8fc7\u6ee4\u5668&amp;\u62e6\u622a\u5668",id:"sping-boot\u4e2d\u7684\u8fc7\u6ee4\u5668\u62e6\u622a\u5668",level:3},{value:"mvc\u4ea4\u4e92\u6d41\u7a0b",id:"mvc\u4ea4\u4e92\u6d41\u7a0b",level:3},{value:"\u62e6\u622a\u5668",id:"\u62e6\u622a\u5668",level:3},{value:"\u62e6\u622a\u5668\u6ce8\u518c",id:"\u62e6\u622a\u5668\u6ce8\u518c",level:3},{value:"\u8fc7\u6ee4\u5668",id:"\u8fc7\u6ee4\u5668",level:3},{value:"\u5b8c\u6574\u4ee3\u7801",id:"\u5b8c\u6574\u4ee3\u7801",level:3}];function c(e){const n={code:"code",h3:"h3",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h3,{id:"sping-boot\u4e2d\u7684\u8fc7\u6ee4\u5668\u62e6\u622a\u5668",children:"sping boot\u4e2d\u7684\u8fc7\u6ee4\u5668&\u62e6\u622a\u5668"}),"\n",(0,o.jsx)(n.h3,{id:"mvc\u4ea4\u4e92\u6d41\u7a0b",children:"mvc\u4ea4\u4e92\u6d41\u7a0b"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:"\n\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\uff09\n\u2193\n[1] HTTP \u8bf7\u6c42\uff08\u4f8b\u5982\uff1aGET /user/profile \u6216 /static/logo.png\uff09\n\u2193\n[2] Web \u5bb9\u5668\uff08Tomcat / Jetty / Undertow\uff09\n\u2193\n[3] \u6240\u6709\u5df2\u6ce8\u518c\u7684 Filter.doFilter()\uff08\u6309 @Order \u987a\u5e8f\u6267\u884c\uff09\n\u2502    \u2190 \u5305\u62ec\uff1aCharacterEncodingFilter\u3001CorsFilter\u3001\u81ea\u5b9a\u4e49 Filter \u7b49\n\u2502    \u2190 **\u9759\u6001\u8d44\u6e90\uff08\u5982 /css/app.css\uff09\u4e5f\u4f1a\u7ecf\u8fc7\u6b64\u5904**\n\u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    \u2502 \u5728 Filter \u4e2d\u8c03\u7528 chain.doFilter() \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502                      \u2193\n\u2502             [4] DispatcherServlet\uff08Spring MVC \u524d\u7aef\u63a7\u5236\u5668\uff09\n\u2502                      \u2193\n\u2502             [5] HandlerMapping\n\u2502                      \u2502 \u2192 \u5c1d\u8bd5\u5339\u914d @Controller \u4e2d\u7684 @RequestMapping\n\u2502                      \u2502\n\u2502                      \u251c\u2500 \u82e5\u5339\u914d\u6210\u529f\uff08\u5982 /user/profile\uff09\u2192 \u8fdb\u5165 Spring MVC \u6d41\u7a0b\n\u2502                      \u2502\n\u2502                      \u2514\u2500 \u82e5\u672a\u5339\u914d\uff08\u5982 /static/logo.png\uff09\u2192\n\u2502                           \u76f4\u63a5\u7531 ResourceHttpRequestHandler \u5904\u7406\uff0c\n\u2502                           **\u8df3\u8fc7\u6240\u6709 Interceptor**\uff0c\u4f46\u4ecd\u4f1a\u8d70\u540e\u7eed Filter\n\u2502\n\u2502                      \u2193\uff08\u4ec5\u5bf9\u5339\u914d\u5230 Controller \u7684\u8bf7\u6c42\uff09\n\u2502             [6] \u6267\u884c\u5df2\u6ce8\u518c\u7684 Interceptor.preHandle()\n\u2502                      \u2502 \u2192 \u6309 addInterceptor() \u6ce8\u518c\u987a\u5e8f\u8c03\u7528\n\u2502                      \u2502 \u2192 \u82e5\u4efb\u4e00\u8fd4\u56de false\uff0c\u5219\u4e2d\u65ad\u6d41\u7a0b\uff0c**\u4e0d\u8c03\u7528 Controller**\n\u2502                      \u2502    \uff08\u4f46\u4ecd\u4f1a\u6267\u884c\u540e\u7eed Filter \u7684\u540e\u534a\u90e8\u5206\u548c afterCompletion\uff09\n\u2502                      \u2193\n\u2502             [7] \u8c03\u7528\u76ee\u6807 Controller \u65b9\u6cd5\n\u2502                      \u2502 \u2192 \u53c2\u6570\u7ed1\u5b9a\uff08@RequestParam, @RequestBody \u7b49\uff09\n\u2502                      \u2502 \u2192 \u6267\u884c\u4e1a\u52a1\u903b\u8f91\n\u2502                      \u2193\n\u2502             [8] Controller \u8fd4\u56de\u7ed3\u679c\n\u2502                      \u2502 \u2192 ModelAndView\uff08\u89c6\u56fe\uff09 \u6216 JSON\uff08@RestController\uff09\n\u2502                      \u2193\n\u2502             [9] \u6267\u884c Interceptor.postHandle()\n\u2502                      \u2502 \u2192 \u53ef\u4fee\u6539 ModelAndView\uff08\u4ec5\u5bf9\u89c6\u56fe\u6709\u6548\uff09\n\u2502                      \u2502 \u2192 **\u82e5 Controller \u629b\u5f02\u5e38\uff0c\u6b64\u65b9\u6cd5\u4e0d\u4f1a\u6267\u884c\uff01**\n\u2502                      \u2193\n\u2502             [10] \u89c6\u56fe\u6e32\u67d3\uff08ViewResolver \u2192 Thymeleaf/JSP\uff09\n\u2502                      \u2502 \u2192 \u6216\u76f4\u63a5\u5199 JSON \u5230 HttpServletResponse\uff08REST\uff09\n\u2502                      \u2193\n\u2502             [11] \u6267\u884c Interceptor.afterCompletion()\n\u2502                      \u2502 \u2192 **\u65e0\u8bba\u6210\u529f\u6216\u5f02\u5e38\uff0c\u90fd\u4f1a\u6267\u884c**\n\u2502                      \u2502 \u2192 \u53ef\u6e05\u7406 ThreadLocal\u3001\u8bb0\u5f55\u65e5\u5fd7\u3001\u5173\u95ed\u8d44\u6e90\u7b49\n\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2191\n\u2502\n[12] \u7ee7\u7eed\u6267\u884c Filter.doFilter() \u7684\u540e\u534a\u90e8\u5206\uff08\u54cd\u5e94\u8fd4\u56de\u9636\u6bb5\uff09\n\u2502    \u2190 \u6240\u6709 Filter \u7684 doFilter() \u65b9\u6cd5\u4e2d chain.doFilter() \u4e4b\u540e\u7684\u4ee3\u7801\n\u2502    \u2190 \u4f8b\u5982\uff1a\u8bb0\u5f55\u54cd\u5e94\u65f6\u95f4\u3001\u4fee\u6539\u54cd\u5e94\u5934\u3001GZIP \u538b\u7f29\u7b49\n\u2193\n[13] HttpServletResponse \u5b8c\u5168\u5199\u56de\u5ba2\u6237\u7aef\n\u2193\n\u5ba2\u6237\u7aef\u6536\u5230 HTML / JSON / \u9759\u6001\u6587\u4ef6\u7b49\u54cd\u5e94\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u62e6\u622a\u5668",children:"\u62e6\u622a\u5668"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'    /**\n     * \u767b\u5f55\u62e6\u622a\u5668\uff1a\u62e6\u622a\u9700\u8981\u767b\u5f55\u7684\u63a5\u53e3\n     */\n    @Component\n    public static class LoginInterceptor implements HandlerInterceptor { // \u6539\u4e3a static\n\n        @Override\n        public boolean preHandle(HttpServletRequest request,\n                                 HttpServletResponse response,\n                                 Object handler) throws IOException {\n\n            String uri = request.getRequestURI();\n            log.info("LoginInterceptor \u62e6\u622a\u8bf7\u6c42: {}", uri);\n\n            // \u53ea\u5904\u7406 Controller \u8bf7\u6c42\n            if (!(handler instanceof HandlerMethod)) {\n                return true;\n            }\n\n            // \u6a21\u62df\u672a\u767b\u5f55\n            String authHeader = request.getHeader("Authorization");\n            if (authHeader == null || !authHeader.startsWith("Bearer ")) {\n                log.warn("\u672a\u767b\u5f55\uff0c\u62d2\u7edd\u8bbf\u95ee: {}", uri);\n                response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n                response.setContentType("application/json;charset=utf-8");\n                response.getWriter().write("{\\"code\\":401, \\"msg\\":\\"\u8bf7\u5148\u767b\u5f55\\"}");\n                return false;\n            }\n\n            return true;\n        }\n\n        @Override\n        public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n            log.info("LoginInterceptor \u62e6\u622a\u8bf7\u6c42\u5b8c\u6210: {}", response.getStatus());\n            HandlerInterceptor.super.afterCompletion(request, response, handler, ex);\n        }\n    }\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\u62e6\u622a\u5668\u6ce8\u518c",children:"\u62e6\u622a\u5668\u6ce8\u518c"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic static class WebConfig implements WebMvcConfigurer { \n\n    @Autowired\n    private LoginInterceptor loginInterceptor;\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        // \u62e6\u622a\u6240\u6709\uff0c\u4f46\u6392\u9664 /public/**\n        registry.addInterceptor(loginInterceptor)\n                .addPathPatterns("/**")\n                .excludePathPatterns("/public/**");\n    }\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\u8fc7\u6ee4\u5668",children:"\u8fc7\u6ee4\u5668"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'/**\n * \u81ea\u5b9a\u4e49 Filter 1\uff1a\u8bb0\u5f55\u6240\u6709\u8bf7\u6c42\uff08\u5305\u62ec\u9759\u6001\u8d44\u6e90\uff09\n */\n@Component\n@Order(1) // \u4f18\u5148\u7ea7\u9ad8\uff08\u6570\u5b57\u5c0f\uff09\npublic static class MyCustomFilter implements Filter {\n\n    @Override\n    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\n            throws IOException, ServletException {\n        HttpServletRequest req = (HttpServletRequest) request;\n        log.info(">>> MyCustomFilter \u5f00\u59cb: {}", req.getRequestURI());\n\n        String token = req.getHeader("Authorization");\n        if (token != null){\n            // \u8fdb\u5165\u7a0b\u5e8f\n            chain.doFilter(request, response);\n        }\n        else{\n            // \u6a21\u62df\u672a\u767b\u5f55\n            log.warn("\u672a\u767b\u5f55\uff0c\u62d2\u7edd\u8bbf\u95ee: {}", req.getRequestURI());\n            HttpServletResponse httpResponse = (HttpServletResponse) response;\n            httpResponse.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n            httpResponse.setContentType("application/json;charset=utf-8");\n            httpResponse.getWriter().write("{\\"code\\":401, \\"msg\\":\\"\u8bf7\u5148\u767b\u5f55\\"}");\n        }\n\n\n        log.info("<<< MyCustomFilter \u7ed3\u675f: {}", req.getRequestURI());\n    }\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\u5b8c\u6574\u4ee3\u7801",children:"\u5b8c\u6574\u4ee3\u7801"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'@Slf4j\n@SpringBootApplication\npublic class MvcTestApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(MvcTestApplication.class, args);\n    }\n\n    @Slf4j\n    @RestController\n    public static class MyController {\n\n        @GetMapping("/test")\n        public String index1() {\n            log.info("\u8bbf\u95ee /test");\n            return "Hello MyController!";\n        }\n\n        @GetMapping("/public/test")\n        public String index2() {\n            log.info("\u8bbf\u95ee /public/test");\n            return "Hello Public!";\n        }\n\n        @PostMapping("/test2")\n        public String index3() {\n            log.info("\u8bbf\u95ee /test2 (POST)");\n            return "Hello POST!";\n        }\n    }\n\n    /**\n     * \u767b\u5f55\u62e6\u622a\u5668\uff1a\u62e6\u622a\u9700\u8981\u767b\u5f55\u7684\u63a5\u53e3\n     */\n    @Component\n    public static class LoginInterceptor implements HandlerInterceptor { // \u6539\u4e3a static\n\n        @Override\n        public boolean preHandle(HttpServletRequest request,\n                                 HttpServletResponse response,\n                                 Object handler) throws IOException {\n\n            String uri = request.getRequestURI();\n            log.info("LoginInterceptor \u62e6\u622a\u8bf7\u6c42: {}", uri);\n\n            // \u53ea\u5904\u7406 Controller \u8bf7\u6c42\n            if (!(handler instanceof HandlerMethod)) {\n                return true;\n            }\n\n            // \u6a21\u62df\u672a\u767b\u5f55\n            String authHeader = request.getHeader("Authorization");\n            if (authHeader == null || !authHeader.startsWith("Bearer ")) {\n                log.warn("\u672a\u767b\u5f55\uff0c\u62d2\u7edd\u8bbf\u95ee: {}", uri);\n                response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n                response.setContentType("application/json;charset=utf-8");\n                response.getWriter().write("{\\"code\\":401, \\"msg\\":\\"\u8bf7\u5148\u767b\u5f55\\"}");\n                return false;\n            }\n\n            return true;\n        }\n\n        @Override\n        public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n            log.info("LoginInterceptor \u62e6\u622a\u8bf7\u6c42\u5b8c\u6210: {}", response.getStatus());\n            HandlerInterceptor.super.afterCompletion(request, response, handler, ex);\n        }\n    }\n    @Component\n    public static class LoginInterceptor2 implements HandlerInterceptor { // \u6539\u4e3a static\n\n        @Override\n        public boolean preHandle(HttpServletRequest request,\n                                 HttpServletResponse response,\n                                 Object handler) throws IOException {\n\n            String uri = request.getRequestURI();\n            log.info("LoginInterceptor2 \u62e6\u622a\u8bf7\u6c42: {}", uri);\n\n            // \u53ea\u5904\u7406 Controller \u8bf7\u6c42\n            if (!(handler instanceof HandlerMethod)) {\n                return true;\n            }\n\n            // \u6a21\u62df\u672a\u767b\u5f55\n            String authHeader = request.getHeader("Authorization");\n            if (authHeader == null || !authHeader.startsWith("Bearer ")) {\n                log.warn("\u672a\u767b\u5f55\uff0c\u62d2\u7edd\u8bbf\u95ee: {}", uri);\n                response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n                response.setContentType("application/json;charset=utf-8");\n                response.getWriter().write("{\\"code\\":401, \\"msg\\":\\"\u8bf7\u5148\u767b\u5f55\\"}");\n                return false;\n            }\n\n            return true;\n        }\n\n        @Override\n        public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n            log.info("LoginInterceptor2 \u62e6\u622a\u8bf7\u6c42\u5b8c\u6210: {}", response.getStatus());\n            HandlerInterceptor.super.afterCompletion(request, response, handler, ex);\n        }\n    }\n\n    @Configuration\n    public static class WebConfig implements WebMvcConfigurer { // \u6539\u4e3a static\n\n        @Autowired\n        private LoginInterceptor loginInterceptor;\n        @Autowired\n        private LoginInterceptor2 loginInterceptor2;\n\n        @Override\n        public void addInterceptors(InterceptorRegistry registry) {\n            // \u62e6\u622a\u6240\u6709\uff0c\u4f46\u6392\u9664 /public/**\n            registry.addInterceptor(loginInterceptor)\n                    .addPathPatterns("/**")\n                    .excludePathPatterns("/public/**");\n            registry.addInterceptor(loginInterceptor2)\n                    .addPathPatterns("/**")\n                    .excludePathPatterns("/public/**");\n        }\n    }\n\n    /**\n     * \u81ea\u5b9a\u4e49 Filter 1\uff1a\u8bb0\u5f55\u6240\u6709\u8bf7\u6c42\uff08\u5305\u62ec\u9759\u6001\u8d44\u6e90\uff09\n     */\n    @Component\n    @Order(1) // \u4f18\u5148\u7ea7\u9ad8\uff08\u6570\u5b57\u5c0f\uff09\n    public static class MyCustomFilter implements Filter {\n\n        @Override\n        public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\n                throws IOException, ServletException {\n            HttpServletRequest req = (HttpServletRequest) request;\n            log.info(">>> MyCustomFilter \u5f00\u59cb: {}", req.getRequestURI());\n\n            String token = req.getHeader("Authorization");\n            if (token != null){\n                // \u8fdb\u5165\u7a0b\u5e8f\n                chain.doFilter(request, response);\n            }\n            else{\n                // \u6a21\u62df\u672a\u767b\u5f55\n                log.warn("\u672a\u767b\u5f55\uff0c\u62d2\u7edd\u8bbf\u95ee: {}", req.getRequestURI());\n                HttpServletResponse httpResponse = (HttpServletResponse) response;\n                httpResponse.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n                httpResponse.setContentType("application/json;charset=utf-8");\n                httpResponse.getWriter().write("{\\"code\\":401, \\"msg\\":\\"\u8bf7\u5148\u767b\u5f55\\"}");\n            }\n\n\n            log.info("<<< MyCustomFilter \u7ed3\u675f: {}", req.getRequestURI());\n        }\n    }\n\n    /**\n     * \u81ea\u5b9a\u4e49 Filter 2\n     */\n    @Component\n    @Order(2)\n    public static class MyCustomFilter2 implements Filter {\n\n        @Override\n        public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\n                throws IOException, ServletException {\n            HttpServletRequest req = (HttpServletRequest) request;\n            log.info(">>> MyCustomFilter2 \u5f00\u59cb: {}", req.getRequestURI());\n\n            chain.doFilter(request, response);\n\n            log.info("<<< MyCustomFilter2 \u7ed3\u675f: {}", req.getRequestURI());\n        }\n    }\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},5856(e){e.exports=JSON.parse('{"permalink":"/docs/blog/java-filter-interceptor","editUrl":"https://github.com/LiangHChao/docs/edit/master/blog/2026-01/2026-01-01-java chain.md","source":"@site/blog/2026-01/2026-01-01-java chain.md","title":"\u8fc7\u6ee4\u5668&\u62e6\u622a\u5668","description":"sping boot\u4e2d\u7684\u8fc7\u6ee4\u5668&\u62e6\u622a\u5668","date":"2026-01-01T00:00:00.000Z","tags":[{"inline":false,"label":"Java","permalink":"/docs/blog/tags/java","description":"Java"},{"inline":true,"label":"filter","permalink":"/docs/blog/tags/filter"},{"inline":true,"label":"interceptor","permalink":"/docs/blog/tags/interceptor"}],"readingTime":4.73,"hasTruncateMarker":false,"authors":[{"name":"lianghchao","title":"Java\u5f00\u53d1\uff0c\u670d\u52a1\u5668\u642d\u5efa\uff0cReact","url":"https://linkedin.com/in/lianghchao","page":{"permalink":"/docs/blog/authors/lianghchao"},"socials":{"x":"https://x.com/lianghchao","linkedin":"https://www.linkedin.com/in/lianghchao/","github":"https://github.com/lianghchao","newsletter":"https://www.greatfrontend.com"},"imageURL":"https://github.com/lianghchao.png","key":"lianghchao"}],"frontMatter":{"slug":"java-filter-interceptor","title":"\u8fc7\u6ee4\u5668&\u62e6\u622a\u5668","authors":["lianghchao"],"tags":["java","filter","interceptor"]},"unlisted":false,"prevItem":{"title":"\u7075\u5149\u4e00\u95ea","permalink":"/docs/blog/exp"},"nextItem":{"title":"GitHub Workflow","permalink":"/docs/blog/server-github-workflow"}}')},8453(e,n,t){t.d(n,{R:()=>i,x:()=>l});var r=t(6540);const o={},s=r.createContext(o);function i(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);