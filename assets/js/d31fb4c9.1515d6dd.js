"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2255],{4661(n,e,t){t.r(e),t.d(e,{assets:()=>s,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"design pattern/2026-01-02-Proxy Patter","title":"\u4ee3\u7406\u6a21\u5f0f","description":"\u4ee3\u7406\u6a21\u5f0f","source":"@site/javadoc/design pattern/2026-01-02-Proxy Patter.md","sourceDirName":"design pattern","slug":"/design pattern/java-Proxy Pattern","permalink":"/docs/javadoc/design pattern/java-Proxy Pattern","draft":false,"unlisted":false,"editUrl":"https://github.com/LiangHChao/docs/edit/master/javadoc/design pattern/2026-01-02-Proxy Patter.md","tags":[{"inline":true,"label":"java","permalink":"/docs/javadoc/tags/java"},{"inline":true,"label":"Proxy Pattern","permalink":"/docs/javadoc/tags/proxy-pattern"}],"version":"current","frontMatter":{"slug":"java-Proxy Pattern","title":"\u4ee3\u7406\u6a21\u5f0f","authors":["lianghchao"],"tags":["java","Proxy Pattern"]},"sidebar":"javaSidebar","previous":{"title":"\u89c2\u5bdf\u8005\u6a21\u5f0f","permalink":"/docs/javadoc/design pattern/java-Observer-patterns"},"next":{"title":"\u6587\u4ef6\u670d\u52a1","permalink":"/docs/javadoc/category/\u6587\u4ef6\u670d\u52a1"}}');var i=t(4848),r=t(8453);const o={slug:"java-Proxy Pattern",title:"\u4ee3\u7406\u6a21\u5f0f",authors:["lianghchao"],tags:["java","Proxy Pattern"]},c=void 0,s={},l=[{value:"\u4ee3\u7406\u6a21\u5f0f",id:"\u4ee3\u7406\u6a21\u5f0f",level:3},{value:"jdk\u52a8\u6001\u4ee3\u7406",id:"jdk\u52a8\u6001\u4ee3\u7406",level:3},{value:"cglib\u52a8\u6001\u4ee3\u7406",id:"cglib\u52a8\u6001\u4ee3\u7406",level:3},{value:"Spring AOP \u4ee3\u7406\u6a21\u5f0f",id:"spring-aop-\u4ee3\u7406\u6a21\u5f0f",level:2},{value:"\u5207\u9762\u4ee3\u7801",id:"\u5207\u9762\u4ee3\u7801",level:3}];function p(n){const e={code:"code",h2:"h2",h3:"h3",pre:"pre",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h3,{id:"\u4ee3\u7406\u6a21\u5f0f",children:"\u4ee3\u7406\u6a21\u5f0f"}),"\n",(0,i.jsx)(e.h3,{id:"jdk\u52a8\u6001\u4ee3\u7406",children:"jdk\u52a8\u6001\u4ee3\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@RestController\n@SpringBootApplication\npublic class ProxyApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(ProxyApplication.class, args);\n    }\n\n    @Resource\n    PaymentService paymentService;\n\n    @GetMapping("test")\n    public String index() {\n        paymentService.processPayment(new BigDecimal("100"));\n        return "Payment processed";\n    }\n\n    public interface PaymentService {\n        void processPayment(BigDecimal amount);\n    }\n    // \u5b9e\u73b0\u7c7b\n    @Service("realPaymentService")\n    public static class AlipayPaymentService implements PaymentService {\n        @Override\n        public void processPayment(BigDecimal amount) {\n            System.out.println("\u652f\u4ed8\u5b9d\u652f\u4ed8: " + amount);\n        }\n    }\n\n    @Configuration\n    public static class JdkProxyFactory {\n        @Bean\n        @Primary\n        public static PaymentService createProxy(@Qualifier("realPaymentService") PaymentService target) {\n            return (PaymentService) Proxy.newProxyInstance(\n                    target.getClass().getClassLoader(),\n                    target.getClass().getInterfaces(),\n                    new InvocationHandler() {\n                        @Override\n                        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n                            System.out.println("\u3010JDK\u4ee3\u7406\u3011\u652f\u4ed8\u524d\u65e5\u5fd7\u8bb0\u5f55");\n                            Object result = method.invoke(target, args);\n                            System.out.println("\u3010JDK\u4ee3\u7406\u3011\u652f\u4ed8\u540e\u53d1\u9001\u901a\u77e5");\n                            return result;\n                        }\n                    }\n            );\n        }\n    }\n\n\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"cglib\u52a8\u6001\u4ee3\u7406",children:"cglib\u52a8\u6001\u4ee3\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@RestController\n@SpringBootApplication\npublic class ProxyApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(ProxyApplication.class, args);\n    }\n\n    @Resource\n    WechatPaymentService paymentService;\n\n    @GetMapping("test")\n    public String index() {\n        paymentService.processPayment(new BigDecimal("100"));\n        return "Payment processed";\n    }\n\n    // \u6ca1\u6709\u5b9e\u73b0\u63a5\u53e3\u7684\u7c7b\n    public static class WechatPaymentService {\n        public void processPayment(BigDecimal amount) {\n            System.out.println("\u5fae\u4fe1\u652f\u4ed8: " + amount);\n        }\n\n        // final \u65b9\u6cd5\u65e0\u6cd5\u88ab\u4ee3\u7406\n        public final void finalMethod() {\n            System.out.println("\u8fd9\u662ffinal\u65b9\u6cd5");\n        }\n    }\n\n    // CGLIB \u4ee3\u7406\u5b9e\u73b0\n    public static class CglibProxyFactory implements MethodInterceptor {\n        private Object target;\n\n        public CglibProxyFactory(Object target) {\n            this.target = target;\n        }\n\n        public Object getProxy() {\n            Enhancer enhancer = new Enhancer();\n            enhancer.setSuperclass(target.getClass());\n            enhancer.setCallback(this);\n            return enhancer.create();\n        }\n\n        @Override\n        public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {\n            System.out.println("\u3010CGLIB\u4ee3\u7406\u3011\u652f\u4ed8\u524d\u65e5\u5fd7\u8bb0\u5f55");\n            Object result = proxy.invokeSuper(obj, args);\n            System.out.println("\u3010CGLIB\u4ee3\u7406\u3011\u652f\u4ed8\u540e\u53d1\u9001\u901a\u77e5");\n            return result;\n        }\n    }\n    // \u914d\u7f6e\u7c7b\uff1a\u624b\u52a8\u521b\u5efa\u5e76\u6ce8\u518c\u4ee3\u7406 Bean\n    @Configuration\n    public static class ProxyConfig {\n\n        @Bean\n        @Primary\n        public WechatPaymentService wechatPaymentService() {\n            // \u521b\u5efa\u771f\u5b9e\u5bf9\u8c61\n            WechatPaymentService target = new WechatPaymentService();\n            // \u521b\u5efa CGLIB \u4ee3\u7406\n            return (WechatPaymentService) new CglibProxyFactory(target).getProxy();\n        }\n    }\n\n\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"spring-aop-\u4ee3\u7406\u6a21\u5f0f",children:"Spring AOP \u4ee3\u7406\u6a21\u5f0f"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-aop</artifactId>\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4e3b\u542f\u52a8\u7c7b\n@SpringBootApplication\n@EnableAspectJAutoProxy // \u542f\u7528 AspectJ \u4ee3\u7406\uff08Spring Boot 2.0+ \u901a\u5e38\u4e0d\u9700\u8981\u663e\u5f0f\u6dfb\u52a0\uff09\npublic class Application {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u5207\u9762\u4ee3\u7801",children:"\u5207\u9762\u4ee3\u7801"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Slf4j\n@Aspect\n@Component\npublic class LoggingAspect {\n    // \u57fa\u672c\u8bed\u6cd5\u7ed3\u6784\n    //execution(modifiers-pattern? ret-type-pattern declaring-type-pattern? name-pattern(param-pattern) throws-pattern?)\n    \n    // \u5e38\u7528\n    //execution(\u8fd4\u56de\u7c7b\u578b \u5305.\u7c7b.\u65b9\u6cd5(\u53c2\u6570))\n\n    // \u5207\u70b9\uff1aservice \u5305\u4e0b\u6240\u6709 public \u65b9\u6cd5\n    @Pointcut("execution(public * com.example.service..*(..))")\n    public void serviceMethods() {}\n    \n    // \u5339\u914d WechatPaymentService \u7684 processPayment \u65b9\u6cd5\uff08\u4efb\u610f\u53c2\u6570\uff09\n    @Pointcut("execution(* proxy.ProxyApplication.WechatPaymentService.processPayment(..))")\n    public void wechatPaymentServiceProcessPayment() {}\n\n    // \u5339\u914d\u6240\u6709\u8fd4\u56de void \u7684\u65b9\u6cd5\n    @Pointcut("execution(void com.service.*.*(..))")\n    public void voidMethods() {}\n\n    // \u5339\u914d\u6240\u6709\u4ee5 "pay" \u5f00\u5934\u7684\u65b9\u6cd5\n    @Pointcut("execution(* com.service.*.pay*(..))")\n    public void payMethods() {}\n\n    // \u5339\u914d WechatPaymentService \u7c7b\u4e2d\u6240\u6709 public \u65b9\u6cd5\n    @Pointcut("execution(public * proxy.ProxyApplication.WechatPaymentService.*(..))")\n    public void wechatPaymentServiceMethods() {}\n\n    // \u5339\u914d service \u5305\u4e0b\u6240\u6709\u7c7b\u7684\u6240\u6709\u65b9\u6cd5\n    @Pointcut("execution(* com.example.service..*(..))")\n    public void serviceClassMethods() {}\n\n    // \u5339\u914d\u6240\u6709\u52a0\u4e86 @Transactional \u7684\u65b9\u6cd5\n    @Pointcut("@annotation(org.springframework.transaction.annotation.Transactional)")\n    public void transactionalMethods() {}\n\n    // \u5339\u914d\u52a0\u4e86\u81ea\u5b9a\u4e49\u6ce8\u89e3\u7684\u65b9\u6cd5\n    @Pointcut("@annotation(com.example.annotation.Loggable)")\n    public void loggableMethods() {}\n\n    // \u5339\u914d\u6240\u6709\u88ab @RestController \u6807\u8bb0\u7684\u7c7b\u4e2d\u7684\u65b9\u6cd5\n    @Pointcut("within(@org.springframework.stereotype.RestController *)")\n    public void restControllerMethods() {}\n\n    // \u5339\u914d service \u5305\u4e0b\u6240\u6709 save \u6216 update \u5f00\u5934\u7684\u65b9\u6cd5\n    @Pointcut("execution(* com.example.service..save*(..)) || execution(* com.example.service..update*(..))")\n    public void saveOrUpdateMethods() {}\n\n    // \u6392\u9664 toString, hashCode \u7b49\u65b9\u6cd5\n    @Pointcut("execution(* com.example.service..*(..)) && !execution(* java.lang.Object.*(..))")\n    public void serviceMethodsExcludingToString() {}\n\n    // \u73af\u7ed5\u901a\u77e5\n    @Around("serviceMethods()")\n    public Object logExecutionTime(ProceedingJoinPoint joinPoint) throws Throwable {\n        long start = System.currentTimeMillis();\n        Object result = joinPoint.proceed();\n        long duration = System.currentTimeMillis() - start;\n        System.out.println(joinPoint.getSignature() + " \u6267\u884c\u8017\u65f6: " + duration + "ms");\n        return result;\n    }\n\n    // \u524d\u7f6e\u901a\u77e5\uff1a\u53ea\u5bf9\u652f\u4ed8\u65b9\u6cd5\n    @Before("execution(* com.example.service.*PaymentService.processPayment(..))")\n    public void beforePayment(JoinPoint joinPoint) {\n        System.out.println("\u3010AOP\u3011\u51c6\u5907\u652f\u4ed8...");\n    }\n}\n'})})]})}function u(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(p,{...n})}):p(n)}},8453(n,e,t){t.d(e,{R:()=>o,x:()=>c});var a=t(6540);const i={},r=a.createContext(i);function o(n){const e=a.useContext(r);return a.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),a.createElement(r.Provider,{value:e},n.children)}}}]);