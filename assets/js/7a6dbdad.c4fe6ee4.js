"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1780],{3625(n,e,t){t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"ddns/2025-12-29-noip-ddns","title":"\u5b9a\u65f6\u4efb\u52a1-\u66f4\u65b0IP","description":"\u66f4\u65b0\u57df\u540d\u89e3\u6790\u5b9a\u65f6\u4efb\u52a1\uff0c\u89e3\u6790\u670d\u52a1\u5546No-IP","source":"@site/javadoc/ddns/2025-12-29-noip-ddns.md","sourceDirName":"ddns","slug":"/ddns/server-tasks-update-ip","permalink":"/docs/javadoc/ddns/server-tasks-update-ip","draft":false,"unlisted":false,"editUrl":"https://github.com/LiangHChao/docs/edit/master/javadoc/ddns/2025-12-29-noip-ddns.md","tags":[{"inline":true,"label":"server","permalink":"/docs/javadoc/tags/server"}],"version":"current","frontMatter":{"slug":"server-tasks-update-ip","title":"\u5b9a\u65f6\u4efb\u52a1-\u66f4\u65b0IP","authors":["lianghchao"],"tags":["server"]},"sidebar":"javaSidebar","previous":{"title":"DDNS","permalink":"/docs/javadoc/category/ddns"},"next":{"title":"Java\u5f02\u6b65\u89e3\u8026","permalink":"/docs/javadoc/java-async"}}');var a=t(4848),s=t(8453);const o={slug:"server-tasks-update-ip",title:"\u5b9a\u65f6\u4efb\u52a1-\u66f4\u65b0IP",authors:["lianghchao"],tags:["server"]},i=void 0,d={},c=[{value:"\u66f4\u65b0\u57df\u540d\u89e3\u6790\u5b9a\u65f6\u4efb\u52a1\uff0c\u89e3\u6790\u670d\u52a1\u5546No-IP",id:"\u66f4\u65b0\u57df\u540d\u89e3\u6790\u5b9a\u65f6\u4efb\u52a1\u89e3\u6790\u670d\u52a1\u5546no-ip",level:2}];function p(n){const e={a:"a",code:"code",h2:"h2",pre:"pre",...(0,s.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.h2,{id:"\u66f4\u65b0\u57df\u540d\u89e3\u6790\u5b9a\u65f6\u4efb\u52a1\u89e3\u6790\u670d\u52a1\u5546no-ip",children:["\u66f4\u65b0\u57df\u540d\u89e3\u6790\u5b9a\u65f6\u4efb\u52a1\uff0c\u89e3\u6790\u670d\u52a1\u5546",(0,a.jsx)(e.a,{href:"https://my.noip.com/",children:"No-IP"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'import cn.hutool.http.HttpRequest;\nimport cn.hutool.core.codec.Base64;\nimport cn.hutool.http.HttpUtil;\nimport jakarta.annotation.PostConstruct;\nimport org.springframework.scheduling.annotation.Scheduled;\nimport org.springframework.stereotype.Component;\n\nimport java.io.BufferedReader;\nimport java.io.InputStreamReader;\nimport java.net.URLEncoder;\nimport java.nio.charset.StandardCharsets;\n\n@Component\npublic class MyScheduledTask {\n\n\n    // \u2699\ufe0f \u914d\u7f6e\u4fe1\u606f\uff08\u8bf7\u66ff\u6362\u4e3a\u4f60\u7684\uff09\n    private static final String USERNAME = "example";\n    private static final String PASSWORD = "example";\n    private static final String HOSTNAME = "example.ddns.net"; // \u8981\u66f4\u65b0\u7684\u57df\u540d\n\n    // \ud83c\udf10 API \u5730\u5740\n    private static final String UPDATE_URL = "https://dynupdate.no-ip.com/nic/update";\n    private static final String IP6_CHECK_URL = "https://ipv6.icanhazip.com"; // \u83b7\u53d6\u516c\u7f51 IPv6\n\n    @Scheduled(cron = "0 0 * * * *")\n    public void updateDNSTask() {\n        updateDNSUtil();\n    }\n    @PostConstruct\n    public void init(){\n        updateDNSUtil();\n    }\n\n    public void updateDNSUtil() {\n        try {\n            // 1. \u83b7\u53d6\u5f53\u524d\u516c\u7f51 IPv6\n            Process process = Runtime.getRuntime().exec("curl -6 --max-time 10 "+IP6_CHECK_URL);\n            BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));\n            String currentIPv6 = reader.readLine();\n            System.out.println(currentIPv6);\n            if (currentIPv6 == null || currentIPv6.trim().isEmpty()) {\n                System.err.println("\u274c \u65e0\u6cd5\u83b7\u53d6\u516c\u7f51 IPv6 \u5730\u5740");\n                return;\n            }\n            System.out.println("\ud83c\udf10 \u5f53\u524d\u516c\u7f51 IPv6: " + currentIPv6);\n\n            // 2. \u66f4\u65b0 No-IP AAAA \u8bb0\u5f55\n            String result = updateNoIpAAAA(currentIPv6);\n            System.out.println("\u2705 \u66f4\u65b0\u7ed3\u679c: " + result);\n\n        } catch (Exception e) {\n            System.err.println("\u274c \u66f4\u65b0\u5931\u8d25: " + e.getMessage());\n        }\n    }\n\n    /**\n     * \u66f4\u65b0 No-IP \u7684 AAAA \u8bb0\u5f55\n     */\n    public static String updateNoIpAAAA(String ipv6) {\n        // \u6784\u9020\u8bf7\u6c42 URL: https://dynupdate.no-ip.com/nic/update?hostname=xxx&myip=IPv6\n        String urlString = UPDATE_URL +\n                "?hostname=" + URLEncoder.encode(HOSTNAME, StandardCharsets.UTF_8) +\n                "&myip=" + URLEncoder.encode(ipv6, StandardCharsets.UTF_8);\n\n        // \u8bbe\u7f6e\u8ba4\u8bc1\u5934\uff1aBasic Base64(username:password)\n        String auth = USERNAME + ":" + PASSWORD;\n        String encodedAuth = Base64.encode(auth.getBytes(StandardCharsets.UTF_8));\n\n        // \u4f7f\u7528 Hutool HttpUtil \u53d1\u9001\u8bf7\u6c42\n        try {\n            String response = HttpRequest.get(urlString)\n                    .header("Authorization", "Basic " + encodedAuth)\n                    .header("User-Agent", "NoIP-Updater-Java/1.0")\n                    .timeout(10000)\n                    .execute()\n                    .body();\n            return response != null ? response.trim() : "Unknown response";\n        } catch (Exception e) {\n            // \u5904\u7406\u5f02\u5e38\u60c5\u51b5\n            return "Error: " + e.getMessage();\n        }\n    }\n\n}\n\n'})})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(p,{...n})}):p(n)}},8453(n,e,t){t.d(e,{R:()=>o,x:()=>i});var r=t(6540);const a={},s=r.createContext(a);function o(n){const e=r.useContext(s);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:o(n.components),r.createElement(s.Provider,{value:e},n.children)}}}]);