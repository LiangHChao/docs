---
slug: server-ssh-frp
title: 内网穿透
authors: [ lianghchao ]
tags: [ server,ssh,frp ]
---

## 在查看服务器查看8001端口映射
```bash
netstat -anp|grep 8001
```

## 编辑配置文件内容
```bash
vi /usr/etc/ssh/sshd_config
Getwayports yes
```
## 重启sshd
```bash
systemctl restart sshd
```

## ssh

- 通过SSH将本地端口（192.168.1.5:8085）映射到服务器（@serverIP）所有IP端口（0.0.0.0:8001）

```bash
ssh -R 0.0.0.0:8001:192.168.1.5:8085 root@serverIP
```
```bash
ssh -R 0.0.0.0:7022:0.0.0.0:7022 root@serverIP
```
```bash
ssh -p 8022 -R 0.0.0.0:8001:127.0.0.1:8001 root@serverIP
```

```bash
echo 1 >/proc/sys/net/ipv4/ip_forward

iptables -t nat -A PREROUTING -d 【公网地址】 -p tcp -m tcp --dport 【公网端口】 -j DNAT --to-destination 【内网IP】:【内网端口】

iptables -t nat -A PREROUTING -d serverIP -p tcp -m tcp --dport 3306 -j DNAT --to-destination 192.168.1.141:3306

```
## 文件服务器映射

```bash
ssh -R 0.0.0.0:21:192.168.1.3:21 root@serverIP
```


## frp服务器配置
```config
bindAddr = "0.0.0.0"
bindPort = 7000
# HTTP 端口（用于内网 HTTP 代理穿透）
vhostHTTPPort = 80
# HTTPS 端口（用于内网 HTTPS 代理穿透）
vhostHTTPSPort = 443

# 监控界面监听地址（`0.0.0.0` 代表所有 IP 可访问）
webServer.addr = "0.0.0.0"
# Web 管理面板端口（可在浏览器访问，默认 7500）
# 你可以通过 `http://你的公网IP:7500` 访问 FRP 管理面板
webServer.port = 7500
# Web 控制台管理账号（可自定义）
webServer.user = "admin"
# Web 控制台密码（请自行修改）
webServer.password = "admin"
# =============================================
# 身份验证（Authentication）配置
# =============================================
#  认证方式（防止未经授权的客户端连接）
# 目前 FRP 支持 `token` 和 `oidc` 方式，我们选用token
auth.method = "token"

#  Token 认证（客户端需要匹配相同 token 才能连接）
# 通俗来说就是密码，写一个你能记住的，尽量长一点
# 示例: 123-abc-123abc
auth.token = "frptoken"   # 请自行修改，不要用我的
```

## frp客户端配置

```config
# 服务端地址（这里要填你有公网IP的服务器的IP或者是服务器的域名）
#serverAddr = "152.32.175.238"
serverAddr = "serverIp"
# 服务器端口（Frp 服务端监听的端口）
serverPort = 7000

# 连接协议
transport.protocol = "tcp"

# 认证方式
auth.method = "token"
# 认证所使用的 Token（要和你刚才配置的服务端token完全一样！）
auth.token = "frptoken"

# 代理配置
[[proxies]]
# 代理名称(标识该代理的名称，根据你的喜好填写）
name = "rocketcat"
# 代理类型（http、https、tcp等）
# 这里要根据你的需求来填写，如果你有域名，就用http
# 如果你没有域名，那就用IP直连，例如:165.0.0.1:8848,此时这里应该写tcp协议
# 如果你用tcp协议就必须把刚才服务端上subDomainHost = "xxxx.com"的配置删除！
# type = "tcp"   # IP+端口直连用这个
type = "tcp"
# 本地 IP（Frp 客户端需要将流量转发到的本地地址）
localIP = "127.0.0.1"
# 本地端口（Frp 客户端需要将流量转发到的本地端口，根据你要穿透的端口来填写）
localPort = 8001
# 访问此代理的子域名
# 如果你没有域名要用IP直连，请把这句删除掉，否则会导致无法连接！
# subdomain = "rocket" # 子域名请根据你拥有的域名配置，配置后通过rocket.xxx.com格式访问

# 如果你不用域名，要用ip+端口直连，请必须加上这句！
# 并且删除 subdomain = "rocket"
remotePort = 8001    # 这个端口和localPort 配置的一模一样，这样才能正常访问！


```